var teams = [{ "team": "Americas Trailblazers", "district": 1 }, { "team": "Coronado Thunderbirds", "district": 1 }, { "team": "Eastlake Falcons", "district": 1 }, { "team": "Eastwood Troopers", "district": 1 }, { "team": "Franklin Cougars", "district": 1 }, { "team": "Montwood Rams", "district": 1 }, { "team": "Pebble Hills Spartans", "district": 1 }, { "team": "Socorro Bulldogs", "district": 1 }, { "team": "Abilene Eagles", "district": 2 }, { "team": "Central Bobcats", "district": 2 }, { "team": "Frenship Tigers", "district": 2 }, { "team": "Lee Rebels", "district": 2 }, { "team": "Midland Bulldogs", "district": 2 }, { "team": "Odessa Bronchos", "district": 2 }, { "team": "Permian Panthers", "district": 2 }, { "team": "Boswell Pioneers", "district": 3 }, { "team": "Chisholm Trail Rangers", "district": 3 }, { "team": "Haltom Buffalos", "district": 3 }, { "team": "L.D. Bell Raiders", "district": 3 }, { "team": "North Crowley Panthers", "district": 3 }, { "team": "Paschal Panthers", "district": 3 }, { "team": "Trinity Trojans", "district": 3 }, { "team": "Weatherford Kangaroos", "district": 3 }, { "team": "Byron Nelson Bobcats", "district": 4 }, { "team": "Carroll Dragons", "district": 4 }, { "team": "Central Chargers", "district": 4 }, { "team": "Eaton Eagles", "district": 4 }, { "team": "Fossil Ridge Panthers", "district": 4 }, { "team": "Keller Indians", "district": 4 }, { "team": "Timber Creek Falcons", "district": 4 }, { "team": "Allen Eagles", "district": 5 }, { "team": "Braswell Bengals", "district": 5 }, { "team": "Guyer Wildcats", "district": 5 }, { "team": "Little Elm Lobos", "district": 5 }, { "team": "McKinney Lions", "district": 5 }, { "team": "McKinney Boyd Broncos", "district": 5 }, { "team": "Prosper Eagles", "district": 5 }, { "team": "Coppell Cowboys", "district": 6 }, { "team": "Flower Mound Jaguars", "district": 6 }, { "team": "Hebron Hawks", "district": 6 }, { "team": "Lewisville Farmers", "district": 6 }, { "team": "Marcus Marauders", "district": 6 }, { "team": "Plano Wildcats", "district": 6 }, { "team": "Plano East Panthers", "district": 6 }, { "team": "Plano West Wolves", "district": 6 }, { "team": "Berkner Rams", "district": 7 }, { "team": "Irving Tigers", "district": 7 }, { "team": "Jesuit Rangers", "district": 7 }, { "team": "Lake Highlands Wildcats", "district": 7 }, { "team": "MacArthur Cardinals", "district": 7 }, { "team": "Nimitz Vikings", "district": 7 }, { "team": "Pearce Mustangs", "district": 7 }, { "team": "Richardson Eagles", "district": 7 }, { "team": "Arlington Colts", "district": 8 }, { "team": "Bowie Volunteers", "district": 8 }, { "team": "Grand Prairie Gophers", "district": 8 }, { "team": "Lamar Vikings", "district": 8 }, { "team": "Martin Warriors", "district": 8 }, { "team": "Sam Houston Texans", "district": 8 }, { "team": "South Grand Prairie Warriors", "district": 8 }, { "team": "Garland Owls", "district": 9 }, { "team": "Lakeview Centennial Patriots", "district": 9 }, { "team": "Naaman Forest Rangers", "district": 9 }, { "team": "North Garland Raiders", "district": 9 }, { "team": "Rowlett Eagles", "district": 9 }, { "team": "Sachse Mustangs", "district": 9 }, { "team": "South Garland Colonels", "district": 9 }, { "team": "Wylie Pirates", "district": 9 }, { "team": "Heath Hawks", "district": 10 }, { "team": "Horn Jaguars", "district": 10 }, { "team": "Lee Red Raiders", "district": 10 }, { "team": "Mesquite Skeeters", "district": 10 }, { "team": "North Mesquite Stallions", "district": 10 }, { "team": "Rockwall Yellow Jackets", "district": 10 }, { "team": "Skyline Raiders", "district": 10 }, { "team": "Cedar Hill Longhorns", "district": 11 }, { "team": "DeSoto Eagles", "district": 11 }, { "team": "Duncanville Panthers", "district": 11 }, { "team": "Lake Ridge Eagles", "district": 11 }, { "team": "Mansfield Tigers", "district": 11 }, { "team": "Midway Panthers", "district": 11 }, { "team": "Waco Lions", "district": 11 }, { "team": "Waxahachie Indians", "district": 11 }, { "team": "Belton Tigers", "district": 12 }, { "team": "Bryan Vikings", "district": 12 }, { "team": "Copperas Cove Bulldawgs", "district": 12 }, { "team": "Ellison Eagles", "district": 12 }, { "team": "Harker Heights Knights", "district": 12 }, { "team": "Killeen Kangaroos", "district": 12 }, { "team": "Shoemaker Grey Wolves", "district": 12 }, { "team": "Temple Wildcats", "district": 12 }, { "team": "College Park Cavaliers", "district": 13 }, { "team": "Conroe Tigers", "district": 13 }, { "team": "Grand Oaks Grizzlies", "district": 13 }, { "team": "Oak Ridge War Eagles", "district": 13 }, { "team": "The Woodlands Highlanders", "district": 13 }, { "team": "Willis Wildkats", "district": 13 }, { "team": "Aldine Mustangs", "district": 14 }, { "team": "Davis Falcons", "district": 14 }, { "team": "DeKaney Wildcats", "district": 14 }, { "team": "Eisenhower Eagles", "district": 14 }, { "team": "MacArthur Generals", "district": 14 }, { "team": "Nimitz Cougars", "district": 14 }, { "team": "Spring Lions", "district": 14 }, { "team": "Westfield Mustangs", "district": 14 }, { "team": "Klein Bearkats", "district": 15 }, { "team": "Klein Cain Hurricanes", "district": 15 }, { "team": "Klein Collins Tigers", "district": 15 }, { "team": "Klein Forest Eagles", "district": 15 }, { "team": "Klein Oak Panthers", "district": 15 }, { "team": "Tomball Cougars", "district": 15 }, { "team": "Tomball Memorial Wildcats", "district": 15 }, { "team": "Bridgeland Bears", "district": 16 }, { "team": "Cy Falls Eagles", "district": 16 }, { "team": "Cy Lakes Spartans", "district": 16 }, { "team": "Cy Park Tigers", "district": 16 }, { "team": "Cy Ranch Mustangs", "district": 16 }, { "team": "Cy Springs Panthers", "district": 16 }, { "team": "Cy Woods Wildcats", "district": 16 }, { "team": "Langham Creek Lobos", "district": 16 }, { "team": "Cy Creek Cougars", "district": 17 }, { "team": "Cy Fair Bobcats", "district": 17 }, { "team": "Cy Ridge Rams", "district": 17 }, { "team": "Jersey Village Falcons", "district": 17 }, { "team": "Hou. Memorial Mustangs", "district": 17 }, { "team": "Northbrook Raiders", "district": 17 }, { "team": "Spring Woods Tigers", "district": 17 }, { "team": "Stratford Spartans", "district": 17 }, { "team": "Bellaire Cardinals", "district": 18 }, { "team": "Chavez Lobos", "district": 18 }, { "team": "Heights Bulldogs", "district": 18 }, { "team": "Lamar Texans", "district": 18 }, { "team": "Sam Houston Tigers", "district": 18 }, { "team": "Westbury Huskies", "district": 18 }, { "team": "Westside Wolves", "district": 18 }, { "team": "Cinco Ranch Cougars", "district": 19 }, { "team": "Katy Tigers", "district": 19 }, { "team": "Mayde Creek Rams", "district": 19 }, { "team": "Morton Ranch Mavericks", "district": 19 }, { "team": "Seven Lakes Spartans", "district": 19 }, { "team": "Taylor Mustangs", "district": 19 }, { "team": "Tompkins Falcons", "district": 19 }, { "team": "Austin Bulldogs", "district": 20 }, { "team": "Bush Broncos", "district": 20 }, { "team": "Clements Rangers", "district": 20 }, { "team": "Dulles Vikings", "district": 20 }, { "team": "Elkins Knights", "district": 20 }, { "team": "George Ranch Longhorns", "district": 20 }, { "team": "Ridge Point Panthers", "district": 20 }, { "team": "Travis Tigers", "district": 20 }, { "team": "Atsacocita Eagles", "district": 21 }, { "team": "C.E. King Panthers", "district": 21 }, { "team": "Humble Wildcats", "district": 21 }, { "team": "Kingwood Mustangs", "district": 21 }, { "team": "North Shore Mustangs", "district": 21 }, { "team": "Summer Creek Bulldogs", "district": 21 }, { "team": "West Brook Bruins", "district": 21 }, { "team": "Channelview Falcons", "district": 22 }, { "team": "Deer Park Deer", "district": 22 }, { "team": "Dobie Longhorns", "district": 22 }, { "team": "Memorial Mavericks", "district": 22 }, { "team": "Pasadena Eagles", "district": 22 }, { "team": "Sam Rayburn Texans", "district": 22 }, { "team": "South Houston Trojans", "district": 22 }, { "team": "Alvin Yellow Jackets", "district": 23 }, { "team": "Dawson Eagles", "district": 23 }, { "team": "Elsik Rams", "district": 23 }, { "team": "Hastings Bears", "district": 23 }, { "team": "Pearland Oilers", "district": 23 }, { "team": "Shadow Creek Sharks", "district": 23 }, { "team": "Strake Jesuit Crusaders", "district": 23 }, { "team": "Taylor Lions", "district": 23 }, { "team": "Brazoswood Buccaneers", "district": 24 }, { "team": "Clear Brook Wolverines", "district": 24 }, { "team": "Clear Creek Wildcats", "district": 24 }, { "team": "Clear Falls Knights", "district": 24 }, { "team": "Clear Lake Falcons", "district": 24 }, { "team": "Clear Springs Chargers", "district": 24 }, { "team": "Dickinson Gators", "district": 24 }, { "team": "Cedar Ridge Raiders", "district": 25 }, { "team": "Hutto Hippos", "district": 25 }, { "team": "McNeil Mavericks", "district": 25 }, { "team": "Round Rock Dragons", "district": 25 }, { "team": "Stony Point Tigers", "district": 25 }, { "team": "Vandegrift Vipers", "district": 25 }, { "team": "Vista Ridge Rangers", "district": 25 }, { "team": "Westwood Warriors", "district": 25 }, { "team": "Akins Eagles", "district": 26 }, { "team": "Austin Maroons", "district": 26 }, { "team": "Bowie Bulldogs", "district": 26 }, { "team": "Del Valle Cardinals", "district": 26 }, { "team": "Hays Rebels", "district": 26 }, { "team": "Lake Travis Cavaliers", "district": 26 }, { "team": "San Marcos Rattlers", "district": 26 }, { "team": "Westlake Chaparrals", "district": 26 }, { "team": "Clemens Buffaloes", "district": 27 }, { "team": "East Central Hornets", "district": 27 }, { "team": "Judson Rockets", "district": 27 }, { "team": "New Braunfels Unicorns", "district": 27 }, { "team": "Smithson Valley Rangers", "district": 27 }, { "team": "South San Antonio Bobcats", "district": 27 }, { "team": "Steele Knights", "district": 27 }, { "team": "Wagner Thunderbirds", "district": 27 }, { "team": "Brandeis Broncos", "district": 28 }, { "team": "Churchill Chargers", "district": 28 }, { "team": "Clark Cougars", "district": 28 }, { "team": "SA Johnson Jaguars", "district": 28 }, { "team": "LEE Volunteers", "district": 28 }, { "team": "MacArthur Brahmas", "district": 28 }, { "team": "Madison Mavericks", "district": 28 }, { "team": "Reagan Rattlers", "district": 28 }, { "team": "Roosevelt Roughriders", "district": 28 }, { "team": "Brennan Bears", "district": 29 }, { "team": "Harlan Hawks", "district": 29 }, { "team": "Holmes Huskies", "district": 29 }, { "team": "Jay Mustangs", "district": 29 }, { "team": "Marshall Rams", "district": 29 }, { "team": "O'Connor Panthers", "district": 29 }, { "team": "Stevens Falcons", "district": 29 }, { "team": "Taft Raiders", "district": 29 }, { "team": "Warren Warriors", "district": 29 }, { "team": "Alexander Bulldogs", "district": 30 }, { "team": "Del Rio Rams", "district": 30 }, { "team": "Eagle Pass Eagles", "district": 30 }, { "team": "LBJ Wolves", "district": 30 }, { "team": "Nixon Mustangs", "district": 30 }, { "team": "United Longhorns", "district": 30 }, { "team": "United South Panthers", "district": 30 }, { "team": "Economedes Jaguars", "district": 31 }, { "team": "Edinburg Bobcats", "district": 31 }, { "team": "Edinburg North Cougars", "district": 31 }, { "team": "Juarez-Lincoln Huskies", "district": 31 }, { "team": "La Joya Coyotes", "district": 31 }, { "team": "Mission Eagles", "district": 31 }, { "team": "PSJA Bears", "district": 31 }, { "team": "PSJA North Raiders", "district": 31 }, { "team": "Vela Sabercats", "district": 31 }, { "team": "Donna North Chiefs", "district": 32 }, { "team": "Hanna Eagles", "district": 32 }, { "team": "Harlingen Cardinals", "district": 32 }, { "team": "Harlingen South Hawks", "district": 32 }, { "team": "Los Fresnos Falcons", "district": 32 }, { "team": "Rivera Raiders", "district": 32 }];



var tea = teams.map((d, i) => {
    return d.team
})
var dis = teams.map((d, i) => {
    return d.district
})
var districts = [];
for (let j = 1; j < 33; j++) {
    var t = teams.filter(d => d.district == j);
    var s = t.map((d, i) => {
        return {
            team: d.team
        };
    });
    var dt = {
        district: j,
        teams: s
    };
    districts.push(dt);
};
var timeParse = d3.timeParse("%d-%b");
d3.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vTQ1MsCH6I9Jdl_icvnZ66m91CtFknDIPio0Yc0gWN5FcRhJ3DkbtMP1rA_tnsOdLUx7pcLOPWhsR_4/pub?output=csv", schedule => {
    schedule.forEach((d, i) => {
        d.date = timeParse(d.Date)
        d.homeDistrict = dis[tea.indexOf(d.Home)]
        d.awayDistrict = dis[tea.indexOf(d.Away)]
        return d;
    });
    ;

    var gamesByKeyDistrict = schedule.filter(d => d.homeDistrict == keyDistrict || d.awayDistrict == keyDistrict)
    var nestedByDay = d3.nest()
        .key(d => d.Date)
        .entries(gamesByKeyDistrict);

    var nestedByDay = nestedByDay.map((d, i) => {
        return d.values;
    });
    console.log(nestedByDay)
    for (let j = 0; j < nestedByDay.length; j++) {
        var games = nestedByDay[j];

        console.log(games)
        d3.select("body").append("div")
            .attr("id", games[0].Date)
            .attr("class", "games")
            .style("width", 680)
            .append("h2")
            .text(games[0].Date)
            .style("text-align", "left")
            .style("font-weight", 700);

        svg = d3.select("body")
            .append("div")
            .attr("id", games[0].Date + "games")
            .attr("class", "games")
            .append("svg")
            .attr("width", 680)
            .attr("height", (Math.round(games.length / 2) * 220) + 20);

        svg.selectAll("teams")
            .data(games)
            .enter()
            .append("text")
            .text((d, i) => d.Away)
            .attr("x", (d, i) => i % 2 == 0 ? 40 : 380)
            .attr("y", (d, i) => Math.round((i + 1) / 2) * 220 - 120)
            .attr("dominant-baseline", "central")
            .attr("font-weight",700)
            .call(wrap, 225)

        svg.selectAll("teams")
            .data(games)
            .enter()
            .append("text")
            .text("Away")
            .attr("x", (d, i) => i % 2 == 0 ? 40 : 380)
            .attr("y", (d, i) => Math.round((i + 1) / 2) * 220 - 180)
            .attr("dominant-baseline", "central")
            .attr("fill", "grey")

        svg.selectAll("teams")
            .data(games)
            .enter()
            .append("text")
            .text("Home")
            .attr("x", (d, i) => i % 2 == 0 ? 40 : 380)
            .attr("y", (d, i) => Math.round((i + 1) / 2) * 220 - 20)
            .attr("dominant-baseline", "central")
            .attr("fill", "grey")

        svg.selectAll("teams")
            .data(games)
            .enter()
            .append("text")
            .text((d, i) => d.Home)
            .attr("x", (d, i) => i % 2 == 0 ? 40 : 380)
            .attr("y", (d, i) => Math.round((i + 1) / 2) * 220 - 70)
            .attr("dominant-baseline", "central")
            .attr("font-weight",700)
            .call(wrap, 225)

        svg.selectAll("teams")
            .data(games)
            .enter()
            .append("rect")
            .attr("x", (d, i) => i % 2 == 0 ? 20 : 360)
            .attr("y", (d, i) => Math.round((i + 1) / 2) * 220 - 200)
            .attr("width", 300)
            .attr("height", 200)
            .attr("fill", "none")
            .attr("stroke", "lightgrey")




    }


    function wrap(text, width) {
        text.each(function () {
            var text = d3.select(this),
                words = text.text().split(/\s+/).reverse(),
                word,
                line = [],
                lineNumber = 0,
                lineHeight = 1.1, // ems
                x = text.attr("x"),
                y = text.attr("y"),
                dy = 0, //parseFloat(text.attr("dy")),
                tspan = text.text(null)
                    .append("tspan")
                    .attr("x", x)
                    .attr("y", y)
                    .attr("dy", dy + "em");
            while (word = words.pop()) {
                line.push(word);
                tspan.text(line.join(" "));
                if (tspan.node().getComputedTextLength() > width) {
                    line.pop();
                    tspan.text(line.join(" "));
                    line = [word];
                    tspan = text.append("tspan")
                        .attr("x", x)
                        .attr("y", y)
                        .attr("dy", ++lineNumber * lineHeight + dy + "em")
                        .text(word);
                }
            }
        });
    }
})