<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  

  <script src="https://d3js.org/d3.v4.min.js"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@jhkforecast">
  <meta name="twitter:creator" content="@jhkersting">
  <meta name="twitter:title" content="Democratic Primary Simulator">
  <meta name="twitter:description" content="Simulate the 2020 Democratic Primary for yourself!">
  <meta name="twitter:image"
    content="https://raw.githubusercontent.com/jhkersting/jhkforecasts/master/2020_dem_prim_img-01.jpg">
  <title>Democratic Primary Simulator</title>
</head>

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140782021-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-140782021-2');
  </script>

  <script data-ad-client="ca-pub-8025120308040073" async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <link rel="icon" href="https://jkstats76.files.wordpress.com/2019/02/cropped-site-icon.png?w=32" sizes="32x32">
  <link rel="icon" href="https://jkstats76.files.wordpress.com/2019/02/cropped-site-icon.png?w=192" sizes="192x192">

  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.1/d3-tip.min.js"></script>
  <link rel="stylesheet" href="https://use.typekit.net/htk2wjy.css">
  <link rel="stylesheet" href="index.css">
  <script src="https:////cdn.jsdelivr.net/npm/jstat@latest/dist/jstat.min.js"></script>



  </style>
</head>

<body>
  <a class="computer" href="https://jhkforecasts.com"><img  style="height: 75px;margin-left: auto;display: block;margin-right: auto;"src="https://raw.githubusercontent.com/jhkersting/jhkforecasts/master/jhk%20forecasts%20logo-01.jpg"/></a>
  <a class="phone" href="https://jhkforecasts.com"><img  style="height: 50px;margin-left: auto;display: block;margin-right: auto;"src="https://jkstats76.files.wordpress.com/2019/02/cropped-site-icon.png"/></a>
  
  
  <body>
    <div id="bigmenu">
      <table style="border-collapse: collapse; border: none;" cellspacing="0" cellpadding="0" width="100%">
        <tbody>
          <tr>
            <td style="width: 33%; border-right: solid grey 1.0pt; " valign="middle" width="33%">
              <a href="https://projects.jhkforecasts.com/democratic_primary/">
                <img style="text-align: center;" src="demprimarymenu-01.svg">
              </a>
            </td>
            <td style="width: 33%; border-right: solid grey 1.0pt; border-left: none; " valign="middle" width="33%">
              <a href="https://projects.jhkforecasts.com/presidential_forecast/">
                <img style="text-align: center;" src="presforecastmenu-01.svg">
            </td>
            <td style="width: 33%; ; " valign="middle" width="33%">
              <a href="https://projects.jhkforecasts.com/senate_forecast/">
                <img style="text-align: center;" src="senateforecastmenu-01.svg">
            </td>
          </tr>
        </tbody>
      </table>
  
  
    </div>
  
  
    <div id="smallmenu">
      <table style="border-collapse: collapse; border: none;" cellspacing="0" cellpadding="0" width="100%">
        <tbody>
          <tr>
            <td style="width: 35%; border-right: solid grey 1.0pt; " valign="top" width="35%">
              <p style="text-align: center;font-weight: 700;font-size: 13px;"><span style="color: black;"><a
                    href="https://projects.jhkforecasts.com/democratic_primary/"><span style="color: black;">Democratic
                      Primary</span></a><span></p>
            </td>
            <td style="width: 30%; border-right: solid grey 1.0pt; border-left: none; " valign="top" width="30%">
              <p style="text-align: center;font-weight: 700;font-size: 13px;"><span style="color: black;"><a
                    href="https://projects.jhkforecasts.com/presidential_forecast/"><span
                      style="color: black;">Presidential</span></a></span></p>
            </td>
            <td style="width: 35%; ; " valign="top" width="35%">
              <p style="text-align: center;font-weight: 700;font-size: 13px;"><span style="color: black;"><a
                    href="https://projects.jhkforecasts.com/senate_forecast/"><span
                      style="color: black;">Senate</span></a></span></p>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  
    <div style="text-align:center ;margin-top: 20px;">
      <button class="btn default" onclick="location.reload();"style="text-align: center;font-weight: 700;font-size: 30px;">New Simulation</button>
  
    </div>


  <div id="bubblemap"></div>
  
  <script>


    var parseTime = d3.timeParse("%Y-%m-%d")
    formatTime = d3.timeFormat("%Y-%m-%d")
    formatValue = d3.format(".1f")
    formatvalue = d3.format(".1f");


    d3.csv("simulator.csv", function (data) {


      var rawvote = data.map((d, k) => {
        return {
          state: d.state,
          date: d.date,
          delegates: +d.total_delegates,
          Bidenvote: +d.Bidenproj,
          Bloombergvote: +d.Bloombergproj,
          Buttigiegvote: +d.Buttigiegproj,
          Klobucharvote: +d.Klobucharproj,
          Sandersvote: +d.Sandersproj,
          Steyervote: +d.Steyerproj,
          Warrenvote: +d.Warrenproj,
          Yangvote: 0,
          bi: +d.bi,
          bl: +d.bl,
          bu: +d.bu,
          kl: +d.kl,
          sa: +d.sa,
          st: +d.st,
          wa: +d.wa,
          ya: 0,
          voteperc: +d.voteperc,
        }
      })

      var data = data.map((d, i) => {
        return {
          state: d.state,
          date: parseTime(d.date),
          delegates: +d.total_delegates,
          Bidenproj: +d.Bidenproj,
          Bloombergproj: +d.Bloombergproj,
          Buttigiegproj: +d.Buttigiegproj,
          Klobucharproj: +d.Klobucharproj,
          Sandersproj: +d.Sandersproj,
          Steyerproj: +d.Steyerproj,
          Warrenproj: +d.Warrenproj,
          Yangproj: +d.Yangproj,
          voteperc: +d.voteperc,
          radius: +d.radius,
          xValue: +d.xValue,
          yValue: +d.yValue,
          abbrev: d.abbrev
        }
      })


      var Bidensimulation = Math.random()
      Bloombergsimulation = Math.random()
      Buttigiegsimulation = Math.random()
      Klobucharsimulation = (Math.random() * 5 + Math.random()) / 6
      Sanderssimulation = Math.random()
      Steyersimulation = (Math.random() * 5 + Math.random()) / 6
      Warrensimulation = (Math.random() * 2 + Math.random()) / 3
      Yangsimulation = 0
      BidenUS = data[57].Bidenproj
      BloombergUS = data[57].Bloombergproj
      ButtigiegUS = data[57].Buttigeigproj
      KlobucharUS = data[57].Klobucharproj
      SandersUS = data[57].Sandersproj
      SteyerUS = data[57].Steyerproj
      WarrenUS = data[57].Warrenproj
      YangUS =0
      firstSectionResults = 0
      secondSectionResults = 0
      thirdSectionResults = 0
      fourthSectionResults = 0






      //IA & NH
      var firstSection = data.slice(0, 2)

      var firstSection = firstSection.map((d, k) => {
        d.Bidenstd = 15
        d.Bloombergstd = 15
        d.Buttigiegstd = 15
        d.Klobucharstd = 15
        d.Sandersstd = 15
        d.Steyerstd = 15
        d.Warrenstd = 15
        d.Yangstd = 15
        d.Bidenvoteraw = jStat.normal.inv((Bidensimulation * 3 + Math.random()) / 4, d.Bidenproj, d.Bidenstd);
        d.Bloombergvoteraw = jStat.normal.inv((Bloombergsimulation * 3 + Math.random()) / 4, d.Bloombergproj, d.Bloombergstd);
        d.Buttigiegvoteraw = jStat.normal.inv((Buttigiegsimulation * 3 + Math.random()) / 4, d.Buttigiegproj, d.Buttigiegstd);
        d.Klobucharvoteraw = jStat.normal.inv((Klobucharsimulation * 3 + Math.random()) / 4, d.Klobucharproj, d.Klobucharstd);
        d.Sandersvoteraw = jStat.normal.inv((Sanderssimulation * 3 + Math.random()) / 4, d.Sandersproj, d.Sandersstd);
        d.Steyervoteraw = jStat.normal.inv((Steyersimulation * 3 + Math.random()) / 4, d.Steyerproj, d.Steyerstd);
        d.Warrenvoteraw = jStat.normal.inv((Warrensimulation * 3 + Math.random()) / 4, d.Warrenproj, d.Warrenstd);
        d.Yangvoteraw = jStat.normal.inv((Yangsimulation * 3 + Math.random()) / 4, d.Yangproj, d.Yangstd);
        d.Bidenvoteraw = d.Bidenvoteraw > 0 ? d.Bidenvoteraw : 0;
        d.Bloombergvoteraw = d.Bloombergvoteraw > 0 ? d.Bloombergvoteraw : 0;
        d.Buttigiegvoteraw = d.Buttigiegvoteraw > 0 ? d.Buttigiegvoteraw : 0;
        d.Klobucharvoteraw = d.Klobucharvoteraw > 0 ? d.Klobucharvoteraw : 0;
        d.Sandersvoteraw = d.Sandersvoteraw > 0 ? d.Sandersvoteraw : 0;
        d.Steyervoteraw = d.Steyervoteraw > 0 ? d.Steyervoteraw : 0;
        d.Warrenvoteraw = d.Warrenvoteraw > 0 ? d.Warrenvoteraw : 0;
        d.Yangvoteraw = d.Yangvoteraw > 0 ? d.Yangvoteraw : 0;
        d.sumvoteraw = d.Bidenvoteraw + d.Bloombergvoteraw + d.Buttigiegvoteraw + d.Klobucharvoteraw + d.Sandersvoteraw + d.Steyervoteraw + d.Warrenvoteraw + d.Yangvoteraw
        d.candsabove0 = (d.Bidenvoteraw > 0 ? 1 : 0) + (d.Bloombergvoteraw > 0 ? 1 : 0) + (d.Buttigiegvoteraw > 0 ? 1 : 0) + (d.Klobucharvoteraw > 0 ? 1 : 0) + (d.Sandersvoteraw > 0 ? 1 : 0) + (d.Steyervoteraw > 0 ? 1 : 0) + (d.Warrenvoteraw > 0 ? 1 : 0) + (d.Yangvoteraw > 0 ? 1 : 0)
        d.sumdistribute = (100 - d.sumvoteraw) / 2
        d.distributeper = d.sumdistribute / d.candsabove0
        d.Bidenvote = d.Bidenvoteraw == 0 ? 0 : d.Bidenvoteraw + d.distributeper + ((d.Bidenvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Bloombergvote = 0
        d.Buttigiegvote = d.Buttigiegvoteraw == 0 ? 0 : d.Buttigiegvoteraw + d.distributeper + ((d.Buttigiegvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Klobucharvote = d.Klobucharvoteraw == 0 ? 0 : d.Klobucharvoteraw + d.distributeper + ((d.Klobucharvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Sandersvote = d.Sandersvoteraw == 0 ? 0 : d.Sandersvoteraw + d.distributeper + ((d.Sandersvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Steyervote = d.Steyervoteraw == 0 ? 0 : d.Steyervoteraw + d.distributeper + ((d.Steyervoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Warrenvote = d.Warrenvoteraw == 0 ? 0 : d.Warrenvoteraw + d.distributeper + ((d.Warrenvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Yangvote = d.Yangvoteraw == 0 ? 0 : d.Yangvoteraw + d.distributeper + ((d.Yangvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.sum = d.Bidenvote + d.Bloombergvote + d.Buttigiegvote + d.Klobucharvote + d.Sandersvote + d.Steyervote + d.Warrenvote + d.Yangvoteraw
        d.Bidenov15 = d.Bidenvote > 15 ? d.Bidenvote : 0
        d.Bloombergov15 = d.Bloombergvote > 15 ? d.Bloombergvote : 0
        d.Buttigiegov15 = d.Buttigiegvote > 15 ? d.Buttigiegvote : 0
        d.Klobucharov15 = d.Klobucharvote > 15 ? d.Klobucharvote : 0
        d.Sandersov15 = d.Sandersvote > 15 ? d.Sandersvote : 0
        d.Steyerov15 = d.Steyervote > 15 ? d.Steyervote : 0
        d.Warrenov15 = d.Warrenvote > 15 ? d.Warrenvote : 0
        d.Yangov15 = d.Yangvote > 15 ? d.Yangvote : 0
        d.sumover15 = d.Bidenov15 + d.Bloombergov15 + d.Buttigiegov15 + d.Klobucharov15 + d.Sandersov15 + d.Steyerov15 + d.Warrenov15 + d.Yangov15
        d.Bidendelegateun15 = d.Bidenov15 == 0 ? Math.round((300 * Math.pow(d.Bidenvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Bloombergdelegateun15 = d.Bloombergov15 == 0 ? Math.round((300 * Math.pow(d.Bloombergvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Buttigiegdelegateun15 = d.Buttigiegov15 == 0 ? Math.round((300 * Math.pow(d.Buttigiegvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Klobuchardelegateun15 = d.Klobcharov15 == 0 ? Math.round((300 * Math.pow(d.Klobucharvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Sandersdelegateun15 = d.Sandersov15 == 0 ? Math.round((300 * Math.pow(d.Sandersvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Steyerdelegateun15 = d.Steyerov15 == 0 ? Math.round((300 * Math.pow(d.Steyervote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Warrendelegateun15 = d.Warrenov15 == 0 ? Math.round((300 * Math.pow(d.Warrenvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Yangdelegateun15 = d.Yangov15 == 0 ? Math.round((300 * Math.pow(d.Yangvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.over15delegates = d.delegates - d.Bidendelegateun15 - d.Bloombergdelegateun15 - d.Buttigiegdelegateun15 - d.Klobuchardelegateun15 - d.Sandersdelegateun15 - d.Steyerdelegateun15 - d.Warrendelegateun15 - d.Yangdelegateun15
        d.Bidendelegateover15 = Math.round((d.Bidenov15 / d.sumover15) * d.over15delegates)
        d.Bloombergdelegateover15 = Math.round((d.Bloombergov15 / d.sumover15) * d.over15delegates)
        d.Buttigiegdelegateover15 = Math.round((d.Buttigiegov15 / d.sumover15) * d.over15delegates)
        d.Klobuchardelegateover15 = Math.round((d.Klobucharov15 / d.sumover15) * d.over15delegates)
        d.Sandersdelegateover15 = Math.round((d.Sandersov15 / d.sumover15) * d.over15delegates)
        d.Steyerdelegateover15 = Math.round((d.Steyerov15 / d.sumover15) * d.over15delegates)
        d.Warrendelegateover15 = Math.round((d.Warrenov15 / d.sumover15) * d.over15delegates)
        d.Yangdelegateover15 = Math.round((d.Yangov15 / d.sumover15) * d.over15delegates)
        d.Bidendelegates = d.Bidendelegateover15 + d.Bidendelegateun15
        d.Bloombergdelegates = d.Bloombergdelegateover15 + d.Bloombergdelegateun15
        d.Buttigiegdelegates = d.Buttigiegdelegateover15 + d.Buttigiegdelegateun15
        d.Klobuchardelegates = d.Klobuchardelegateover15 + d.Klobuchardelegateun15
        d.Sandersdelegates = d.Sandersdelegateover15 + d.Sandersdelegateun15
        d.Steyerdelegates = d.Steyerdelegateover15 + d.Steyerdelegateun15
        d.Warrendelegates = d.Warrendelegateover15 + d.Warrendelegateun15
        d.Yangdelegates = d.Yangdelegateover15 + d.Yangdelegateun15

        d.voteperc = d.voteperc
        return d;
      })

      firstSection[0].Bidenvote = 15.8
      firstSection[0].Bloombergvote = 0
      firstSection[0].Buttigiegvote = 26.2
      firstSection[0].Klobucharvote = 12.3
      firstSection[0].Sandersvote = 26.1
      firstSection[0].Steyervote = 0.3
      firstSection[0].Warrenvote = 18
      firstSection[0].Yangvote = 1
      firstSection[0].Bidendelegates = 6
      firstSection[0].Bloombergdelegates = 0
      firstSection[0].Buttigiegdelegates = 14
      firstSection[0].Klobuchardelegates = 1
      firstSection[0].Sandersdelegates = 12
      firstSection[0].Steyerdelegates = 0
      firstSection[0].Warrendelegates = 8
      firstSection[0].Yangdelegates = 0


      firstSection[1].Bidenvote = 8.7
      firstSection[1].Bloombergvote = 0
      firstSection[1].Buttigiegvote = 24.2
      firstSection[1].Klobucharvote = 19.8
      firstSection[1].Sandersvote = 25.9
      firstSection[1].Steyervote = 3.6
      firstSection[1].Warrenvote = 9.3
      firstSection[1].Yangvote = 2.8
      firstSection[1].Bidendelegates = 0
      firstSection[1].Bloombergdelegates = 0
      firstSection[1].Buttigiegdelegates = 9
      firstSection[1].Klobuchardelegates = 6
      firstSection[1].Sandersdelegates = 9
      firstSection[1].Steyerdelegates = 0
      firstSection[1].Warrendelegates = 0
      firstSection[1].Yangdelegates = 0


      firstSection.forEach(function (d) {
        d.winner = Math.max(d.Bidenvote, d.Bloombergvote, d.Buttigiegvote, d.Klobucharvote, d.Sandersvote, d.Steyervote, d.Warrenvote, d.Yangvote)
        d.Bidenwin = d.winner == d.Bidenvote ? 1 : 0
        d.Bloombergwin = d.winner == d.Bloombergvote ? 1 : 0
        d.Buttigiegwin = d.winner == d.Buttigiegvote ? 1 : 0
        d.Klobucharwin = d.winner == d.Klobucharvote ? 1 : 0
        d.Sanderswin = d.winner == d.Sandersvote ? 1 : 0
        d.Steyerwin = d.winner == d.Steyervote ? 1 : 0
        d.Warrenwin = d.winner == d.Warrenvote ? 1 : 0
        d.Yangwin = d.winner == d.Yangvote ? 1 : 0
        d.winner = d.Bidenwin == 1 ? "Biden" : d.Bloombergwin == 1 ? "Bloomberg" : d.Buttigiegwin == 1 ? "Buttigieg" : d.Klobucharwin == 1 ? "Klobuchar" : d.Sanderswin == 1 ? "Sanders" : d.Steyerwin == 1 ? "Steyer" : d.Warrenwin == 1 ? "Warren" : "Yang"
        return d;
      })




      var firstSectionResults = [{ Candidate: "Biden", Delegates: d3.sum(firstSection, d => d.Bidendelegates) },
      { Candidate: "Bloomberg", Delegates: d3.sum(firstSection, d => d.Bloombergdelegates) },
      { Candidate: "Buttigieg", Delegates: d3.sum(firstSection, d => d.Buttigiegdelegates) },
      { Candidate: "Klobuchar", Delegates: d3.sum(firstSection, d => d.Klobuchardelegates) },
      { Candidate: "Sanders", Delegates: d3.sum(firstSection, d => d.Sandersdelegates) },
      { Candidate: "Steyer", Delegates: d3.sum(firstSection, d => d.Steyerdelegates) },
      { Candidate: "Warren", Delegates: d3.sum(firstSection, d => d.Warrendelegates) },
      { Candidate: "Yang", Delegates: d3.sum(firstSection, d => d.Yangdelegates) },
      ]

      firstSectionResults.forEach(function (d) {
        d.dropOut = d.Delegates == 5 ? Math.random() < .4 ? 1 : 0 : 0;
        return d;
      })




      Bidenbump = 0
      Bloombergbump = 0
      Buttigiegbump = 0
      Klobucharbump = 0
      Sandersbump = 0
      Steyerbump = 0
      Warrenbump = 0
      Yangbump = 0

      //Bidenbump = firstSection[1].Bidenwin * 3 + firstSection[1].Bidenwin * 3
      //Bloombergbump = 2
      //Buttigiegbump = firstSection[1].Buttigiegwin * 3 + firstSection[1].Buttigiegwin * 1
      //Klobucharbump = firstSection[1].Klobucharwin * 5 + firstSection[1].Klobucharwin * 5
      //Sandersbump = firstSection[1].Sanderswin * 4 + firstSection[1].Sanderswin * 4
      //Steyerbump = firstSection[1].Steyerwin * 4 + firstSection[1].Steyerwin * 2
      //Warrenbump = firstSection[1].Warrenwin * 3 + firstSection[1].Warrenwin * 2
      //Yangbump = firstSection[1].Yangwin * 3 + firstSection[1].Yangwin * 3




      firstSectionResults[1].dropOut = 0
      firstSectionResults[5].dropOut = 0
      //NV-Super Tuesday



      var dataadj = data.map((d, i) => {
        d.Bidenproj = d.Bidenproj
        d.Bloombergproj = d.Bloombergproj
        d.Buttigiegproj = d.Buttigiegproj
        d.Klobucharproj = d.Klobucharproj
        d.Sandersproj = d.Sandersproj
        d.Steyerproj = d.Steyerproj
        d.Warrenproj = d.Warrenproj
        d.Yangproj = d.Yangproj
        return d;
      })




      var secondSection = dataadj.slice(2, 20)


      var secondSection = secondSection.map((d, k) => {
        d.Bidenstd = 17
        d.Bloombergstd = 17
        d.Buttigiegstd = 17
        d.Klobucharstd = 17
        d.Sandersstd = 17
        d.Steyerstd = 17
        d.Warrenstd = 17
        d.Yangstd = 17
        d.Bidenvoteraw = firstSectionResults[0].dropOut == 1 ? 0 : jStat.normal.inv((Bidensimulation * 3 + Math.random()) / 4, d.Bidenproj, d.Bidenstd);
        d.Bloombergvoteraw = firstSectionResults[1].dropOut == 1 ? 0 : jStat.normal.inv((Bloombergsimulation * 3 + Math.random()) / 4, d.Bloombergproj, d.Bloombergstd);
        d.Buttigiegvoteraw = firstSectionResults[2].dropOut == 1 ? 0 : jStat.normal.inv((Buttigiegsimulation * 3 + Math.random()) / 4, d.Buttigiegproj, d.Buttigiegstd);
        d.Klobucharvoteraw = firstSectionResults[3].dropOut == 1 ? 0 : jStat.normal.inv((Klobucharsimulation * 3 + Math.random()) / 4, d.Klobucharproj, d.Klobucharstd);
        d.Sandersvoteraw = firstSectionResults[4].dropOut == 1 ? 0 : jStat.normal.inv((Sanderssimulation * 3 + Math.random()) / 4, d.Sandersproj, d.Sandersstd);
        d.Steyervoteraw = firstSectionResults[5].dropOut == 1 ? 0 : jStat.normal.inv((Steyersimulation * 3 + Math.random()) / 4, d.Steyerproj, d.Steyerstd);
        d.Warrenvoteraw = firstSectionResults[6].dropOut == 1 ? 0 : jStat.normal.inv((Warrensimulation * 3 + Math.random()) / 4, d.Warrenproj, d.Warrenstd);
        d.Yangvoteraw = firstSectionResults[7].dropOut == 1 ? 0 : jStat.normal.inv((Yangsimulation * 3 + Math.random()) / 4, d.Yangproj, d.Yangstd);
        d.Bidenvoteraw = d.Bidenvoteraw > 0 ? d.Bidenvoteraw : 0;
        d.Bloombergvoteraw = d.Bloombergvoteraw > 0 ? d.Bloombergvoteraw : 0;
        d.Buttigiegvoteraw = d.Buttigiegvoteraw > 0 ? d.Buttigiegvoteraw : 0;
        d.Klobucharvoteraw = d.Klobucharvoteraw > 0 ? d.Klobucharvoteraw : 0;
        d.Sandersvoteraw = d.Sandersvoteraw > 0 ? d.Sandersvoteraw : 0;
        d.Steyervoteraw = d.Steyervoteraw > 0 ? d.Steyervoteraw : 0;
        d.Warrenvoteraw = d.Warrenvoteraw > 0 ? d.Warrenvoteraw : 0;
        d.Yangvoteraw = d.Yangvoteraw > 0 ? d.Yangvoteraw : 0;
        d.sumvoteraw = d.Bidenvoteraw + d.Bloombergvoteraw + d.Buttigiegvoteraw + d.Klobucharvoteraw + d.Sandersvoteraw + d.Steyervoteraw + d.Warrenvoteraw + d.Yangvoteraw
        d.candsabove0 = (d.Bidenvoteraw > 0 ? 1 : 0) + (d.Bloombergvoteraw > 0 ? 1 : 0) + (d.Buttigiegvoteraw > 0 ? 1 : 0) + (d.Klobucharvoteraw > 0 ? 1 : 0) + (d.Sandersvoteraw > 0 ? 1 : 0) + (d.Steyervoteraw > 0 ? 1 : 0) + (d.Warrenvoteraw > 0 ? 1 : 0) + (d.Yangvoteraw > 0 ? 1 : 0)
        d.sumdistribute = (100 - d.sumvoteraw) / 2
        d.distributeper = d.sumdistribute / d.candsabove0
        d.Bidenvote = d.Bidenvoteraw == 0 ? 0 : d.Bidenvoteraw + d.distributeper + ((d.Bidenvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Bloombergvote = d.Bloombergvoteraw == 0 ? 0 : d.Bloombergvoteraw + d.distributeper + ((d.Bloombergvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Buttigiegvote = d.Buttigiegvoteraw == 0 ? 0 : d.Buttigiegvoteraw + d.distributeper + ((d.Buttigiegvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Klobucharvote = d.Klobucharvoteraw == 0 ? 0 : d.Klobucharvoteraw + d.distributeper + ((d.Klobucharvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Sandersvote = d.Sandersvoteraw == 0 ? 0 : d.Sandersvoteraw + d.distributeper + ((d.Sandersvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Steyervote = d.Steyervoteraw == 0 ? 0 : d.Steyervoteraw + d.distributeper + ((d.Steyervoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Warrenvote = d.Warrenvoteraw == 0 ? 0 : d.Warrenvoteraw + d.distributeper + ((d.Warrenvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Yangvote = d.Yangvoteraw == 0 ? 0 : d.Yangvoteraw + d.distributeper + ((d.Yangvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Bidenov15 = d.Bidenvote > 15 ? d.Bidenvote : 0
        d.Bloombergov15 = d.Bloombergvote > 15 ? d.Bloombergvote : 0
        d.Buttigiegov15 = d.Buttigiegvote > 15 ? d.Buttigiegvote : 0
        d.Klobucharov15 = d.Klobucharvote > 15 ? d.Klobucharvote : 0
        d.Sandersov15 = d.Sandersvote > 15 ? d.Sandersvote : 0
        d.Steyerov15 = d.Steyervote > 15 ? d.Steyervote : 0
        d.Warrenov15 = d.Warrenvote > 15 ? d.Warrenvote : 0
        d.Yangov15 = d.Yangvote > 15 ? d.Yangvote : 0
        d.sumover15 = d.Bidenov15 + d.Bloombergov15 + d.Buttigiegov15 + d.Klobucharov15 + d.Sandersov15 + d.Steyerov15 + d.Warrenov15 + d.Yangov15
        d.Bidendelegateun15 = d.Bidenov15 == 0 ? Math.round((300 * Math.pow(d.Bidenvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Bloombergdelegateun15 = d.Bloombergov15 == 0 ? Math.round((300 * Math.pow(d.Bloombergvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Buttigiegdelegateun15 = d.Buttigiegov15 == 0 ? Math.round((300 * Math.pow(d.Buttigiegvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Klobuchardelegateun15 = d.Klobcharov15 == 0 ? Math.round((300 * Math.pow(d.Klobucharvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Sandersdelegateun15 = d.Sandersov15 == 0 ? Math.round((300 * Math.pow(d.Sandersvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Steyerdelegateun15 = d.Steyerov15 == 0 ? Math.round((300 * Math.pow(d.Steyervote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Warrendelegateun15 = d.Warrenov15 == 0 ? Math.round((300 * Math.pow(d.Warrenvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Yangdelegateun15 = d.Yangov15 == 0 ? Math.round((300 * Math.pow(d.Yangvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.over15delegates = d.delegates - d.Bidendelegateun15 - d.Bloombergdelegateun15 - d.Buttigiegdelegateun15 - d.Klobuchardelegateun15 - d.Sandersdelegateun15 - d.Steyerdelegateun15 - d.Warrendelegateun15 - d.Yangdelegateun15
        d.Bidendelegateover15 = Math.round((d.Bidenov15 / d.sumover15) * d.over15delegates)
        d.Bloombergdelegateover15 = Math.round((d.Bloombergov15 / d.sumover15) * d.over15delegates)
        d.Buttigiegdelegateover15 = Math.round((d.Buttigiegov15 / d.sumover15) * d.over15delegates)
        d.Klobuchardelegateover15 = Math.round((d.Klobucharov15 / d.sumover15) * d.over15delegates)
        d.Sandersdelegateover15 = Math.round((d.Sandersov15 / d.sumover15) * d.over15delegates)
        d.Steyerdelegateover15 = Math.round((d.Steyerov15 / d.sumover15) * d.over15delegates)
        d.Warrendelegateover15 = Math.round((d.Warrenov15 / d.sumover15) * d.over15delegates)
        d.Yangdelegateover15 = Math.round((d.Yangov15 / d.sumover15) * d.over15delegates)
        d.Bidendelegates = d.Bidendelegateover15 + d.Bidendelegateun15
        d.Bloombergdelegates = d.Bloombergdelegateover15 + d.Bloombergdelegateun15
        d.Buttigiegdelegates = d.Buttigiegdelegateover15 + d.Buttigiegdelegateun15
        d.Klobuchardelegates = d.Klobuchardelegateover15 + d.Klobuchardelegateun15
        d.Sandersdelegates = d.Sandersdelegateover15 + d.Sandersdelegateun15
        d.Steyerdelegates = d.Steyerdelegateover15 + d.Steyerdelegateun15
        d.Warrendelegates = d.Warrendelegateover15 + d.Warrendelegateun15
        d.Yangdelegates = d.Yangdelegateover15 + d.Yangdelegateun15

        return d;
      })
      secondSection[0].Bloombergvote = 0
      secondSection[1].Bloombergvote = 0
      secondSection[0].Bloombergdelegates = 0
      secondSection[1].Bloombergdelegates = 0

      var secondSectionResults = [{ Candidate: "Biden", Delegates: d3.sum(secondSection, d => d.Bidendelegates), dropOut: firstSectionResults[0].dropOut },
      { Candidate: "Bloomberg", Delegates: d3.sum(secondSection, d => d.Bloombergdelegates), dropOut: firstSectionResults[1].dropOut },
      { Candidate: "Buttigieg", Delegates: d3.sum(secondSection, d => d.Buttigiegdelegates), dropOut: firstSectionResults[2].dropOut },
      { Candidate: "Klobuchar", Delegates: d3.sum(secondSection, d => d.Klobuchardelegates), dropOut: firstSectionResults[3].dropOut },
      { Candidate: "Sanders", Delegates: d3.sum(secondSection, d => d.Sandersdelegates), dropOut: firstSectionResults[4].dropOut },
      { Candidate: "Steyer", Delegates: d3.sum(secondSection, d => d.Steyerdelegates), dropOut: firstSectionResults[5].dropOut },
      { Candidate: "Warren", Delegates: d3.sum(secondSection, d => d.Warrendelegates), dropOut: firstSectionResults[6].dropOut },
      { Candidate: "Yang", Delegates: d3.sum(secondSection, d => d.Yangdelegates), dropOut: firstSectionResults[7].dropOut },
      ]

      secondSectionResults.forEach(function (d) {
        d.dropOut = d.dropOut == 1 ? 1 : d.Delegates == 0 ? 1 : d.Delegates < 75 ? Math.random() < .50 ? 1 : 0 : 0;
        return d;
      })
      secondSectionResults[1].dropOut = 0
      //mar. 10 & mar. 17

      var thirdSection = dataadj.slice(20, 30)


      var thirdSection = thirdSection.map((d, k) => {
        d.Bidenstd = 20
        d.Bloombergstd = 20
        d.Buttigiegstd = 20
        d.Klobucharstd = 20
        d.Sandersstd = 20
        d.Steyerstd = 20
        d.Warrenstd = 20
        d.Yangstd = 20
        d.Bidenvoteraw = secondSectionResults[0].dropOut == 1 ? 0 : jStat.normal.inv((Bidensimulation * 3 + Math.random()) / 4, d.Bidenproj, d.Bidenstd);
        d.Bloombergvoteraw = secondSectionResults[1].dropOut == 1 ? 0 : jStat.normal.inv((Bloombergsimulation * 3 + Math.random()) / 4, d.Bloombergproj, d.Bloombergstd);
        d.Buttigiegvoteraw = secondSectionResults[2].dropOut == 1 ? 0 : jStat.normal.inv((Buttigiegsimulation * 3 + Math.random()) / 4, d.Buttigiegproj, d.Buttigiegstd);
        d.Klobucharvoteraw = secondSectionResults[3].dropOut == 1 ? 0 : jStat.normal.inv((Klobucharsimulation * 3 + Math.random()) / 4, d.Klobucharproj, d.Klobucharstd);
        d.Sandersvoteraw = secondSectionResults[4].dropOut == 1 ? 0 : jStat.normal.inv((Sanderssimulation * 3 + Math.random()) / 4, d.Sandersproj, d.Sandersstd);
        d.Steyervoteraw = secondSectionResults[5].dropOut == 1 ? 0 : jStat.normal.inv((Steyersimulation * 3 + Math.random()) / 4, d.Steyerproj, d.Steyerstd);
        d.Warrenvoteraw = secondSectionResults[6].dropOut == 1 ? 0 : jStat.normal.inv((Warrensimulation * 3 + Math.random()) / 4, d.Warrenproj, d.Warrenstd);
        d.Yangvoteraw = secondSectionResults[7].dropOut == 1 ? 0 : jStat.normal.inv((Yangsimulation * 3 + Math.random()) / 4, d.Yangproj, d.Yangstd);
        d.Bidenvoteraw = d.Bidenvoteraw > 0 ? d.Bidenvoteraw : 0;
        d.Bloombergvoteraw = d.Bloombergvoteraw > 0 ? d.Bloombergvoteraw : 0;
        d.Buttigiegvoteraw = d.Buttigiegvoteraw > 0 ? d.Buttigiegvoteraw : 0;
        d.Klobucharvoteraw = d.Klobucharvoteraw > 0 ? d.Klobucharvoteraw : 0;
        d.Sandersvoteraw = d.Sandersvoteraw > 0 ? d.Sandersvoteraw : 0;
        d.Steyervoteraw = d.Steyervoteraw > 0 ? d.Steyervoteraw : 0;
        d.Warrenvoteraw = d.Warrenvoteraw > 0 ? d.Warrenvoteraw : 0;
        d.Yangvoteraw = d.Yangvoteraw > 0 ? d.Yangvoteraw : 0;
        d.sumvoteraw = d.Bidenvoteraw + d.Bloombergvoteraw + d.Buttigiegvoteraw + d.Klobucharvoteraw + d.Sandersvoteraw + d.Steyervoteraw + d.Warrenvoteraw + d.Yangvoteraw
        d.candsabove0 = (d.Bidenvoteraw > 0 ? 1 : 0) + (d.Bloombergvoteraw > 0 ? 1 : 0) + (d.Buttigiegvoteraw > 0 ? 1 : 0) + (d.Klobucharvoteraw > 0 ? 1 : 0) + (d.Sandersvoteraw > 0 ? 1 : 0) + (d.Steyervoteraw > 0 ? 1 : 0) + (d.Warrenvoteraw > 0 ? 1 : 0) + (d.Yangvoteraw > 0 ? 1 : 0)
        d.sumdistribute = (100 - d.sumvoteraw) / 2
        d.distributeper = d.sumdistribute / d.candsabove0
        d.Bidenvote = d.Bidenvoteraw == 0 ? 0 : d.Bidenvoteraw + d.distributeper + ((d.Bidenvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Bloombergvote = d.Bloombergvoteraw == 0 ? 0 : d.Bloombergvoteraw + d.distributeper + ((d.Bloombergvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Buttigiegvote = d.Buttigiegvoteraw == 0 ? 0 : d.Buttigiegvoteraw + d.distributeper + ((d.Buttigiegvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Klobucharvote = d.Klobucharvoteraw == 0 ? 0 : d.Klobucharvoteraw + d.distributeper + ((d.Klobucharvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Sandersvote = d.Sandersvoteraw == 0 ? 0 : d.Sandersvoteraw + d.distributeper + ((d.Sandersvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Steyervote = d.Steyervoteraw == 0 ? 0 : d.Steyervoteraw + d.distributeper + ((d.Steyervoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Warrenvote = d.Warrenvoteraw == 0 ? 0 : d.Warrenvoteraw + d.distributeper + ((d.Warrenvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Yangvote = d.Yangvoteraw == 0 ? 0 : d.Yangvoteraw + d.distributeper + ((d.Yangvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Bidenov15 = d.Bidenvote > 15 ? d.Bidenvote : 0
        d.Bloombergov15 = d.Bloombergvote > 15 ? d.Bloombergvote : 0
        d.Buttigiegov15 = d.Buttigiegvote > 15 ? d.Buttigiegvote : 0
        d.Klobucharov15 = d.Klobucharvote > 15 ? d.Klobucharvote : 0
        d.Sandersov15 = d.Sandersvote > 15 ? d.Sandersvote : 0
        d.Steyerov15 = d.Steyervote > 15 ? d.Steyervote : 0
        d.Warrenov15 = d.Warrenvote > 15 ? d.Warrenvote : 0
        d.Yangov15 = d.Yangvote > 15 ? d.Yangvote : 0
        d.sumover15 = d.Bidenov15 + d.Bloombergov15 + d.Buttigiegov15 + d.Klobucharov15 + d.Sandersov15 + d.Steyerov15 + d.Warrenov15 + d.Yangov15
        d.Bidendelegateun15 = d.Bidenov15 == 0 ? Math.round((300 * Math.pow(d.Bidenvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Bloombergdelegateun15 = d.Bloombergov15 == 0 ? Math.round((300 * Math.pow(d.Bloombergvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Buttigiegdelegateun15 = d.Buttigiegov15 == 0 ? Math.round((300 * Math.pow(d.Buttigiegvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Klobuchardelegateun15 = d.Klobcharov15 == 0 ? Math.round((300 * Math.pow(d.Klobucharvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Sandersdelegateun15 = d.Sandersov15 == 0 ? Math.round((300 * Math.pow(d.Sandersvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Steyerdelegateun15 = d.Steyerov15 == 0 ? Math.round((300 * Math.pow(d.Steyervote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Warrendelegateun15 = d.Warrenov15 == 0 ? Math.round((300 * Math.pow(d.Warrenvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Yangdelegateun15 = d.Yangov15 == 0 ? Math.round((300 * Math.pow(d.Yangvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.over15delegates = d.delegates - d.Bidendelegateun15 - d.Bloombergdelegateun15 - d.Buttigiegdelegateun15 - d.Klobuchardelegateun15 - d.Sandersdelegateun15 - d.Steyerdelegateun15 - d.Warrendelegateun15 - d.Yangdelegateun15
        d.Bidendelegateover15 = Math.round((d.Bidenov15 / d.sumover15) * d.over15delegates)
        d.Bloombergdelegateover15 = Math.round((d.Bloombergov15 / d.sumover15) * d.over15delegates)
        d.Buttigiegdelegateover15 = Math.round((d.Buttigiegov15 / d.sumover15) * d.over15delegates)
        d.Klobuchardelegateover15 = Math.round((d.Klobucharov15 / d.sumover15) * d.over15delegates)
        d.Sandersdelegateover15 = Math.round((d.Sandersov15 / d.sumover15) * d.over15delegates)
        d.Steyerdelegateover15 = Math.round((d.Steyerov15 / d.sumover15) * d.over15delegates)
        d.Warrendelegateover15 = Math.round((d.Warrenov15 / d.sumover15) * d.over15delegates)
        d.Yangdelegateover15 = Math.round((d.Yangov15 / d.sumover15) * d.over15delegates)
        d.Bidendelegates = d.Bidendelegateover15 + d.Bidendelegateun15
        d.Bloombergdelegates = d.Bloombergdelegateover15 + d.Bloombergdelegateun15
        d.Buttigiegdelegates = d.Buttigiegdelegateover15 + d.Buttigiegdelegateun15
        d.Klobuchardelegates = d.Klobuchardelegateover15 + d.Klobuchardelegateun15
        d.Sandersdelegates = d.Sandersdelegateover15 + d.Sandersdelegateun15
        d.Steyerdelegates = d.Steyerdelegateover15 + d.Steyerdelegateun15
        d.Warrendelegates = d.Warrendelegateover15 + d.Warrendelegateun15
        d.Yangdelegates = d.Yangdelegateover15 + d.Yangdelegateun15

        return d;
      })

      var thirdSectionResults = [{ Candidate: "Biden", Delegates: d3.sum(thirdSection, d => d.Bidendelegates), dropOut: secondSectionResults[0].dropOut },
      { Candidate: "Bloomberg", Delegates: d3.sum(thirdSection, d => d.Bloombergdelegates), dropOut: secondSectionResults[1].dropOut },
      { Candidate: "Buttigieg", Delegates: d3.sum(thirdSection, d => d.Buttigiegdelegates), dropOut: secondSectionResults[2].dropOut },
      { Candidate: "Klobuchar", Delegates: d3.sum(thirdSection, d => d.Klobuchardelegates), dropOut: secondSectionResults[3].dropOut },
      { Candidate: "Sanders", Delegates: d3.sum(thirdSection, d => d.Sandersdelegates), dropOut: secondSectionResults[4].dropOut },
      { Candidate: "Steyer", Delegates: d3.sum(thirdSection, d => d.Steyerdelegates), dropOut: secondSectionResults[5].dropOut },
      { Candidate: "Warren", Delegates: d3.sum(thirdSection, d => d.Warrendelegates), dropOut: secondSectionResults[6].dropOut },
      { Candidate: "Yang", Delegates: d3.sum(thirdSection, d => d.Yangdelegates), dropOut: secondSectionResults[7].dropOut },
      ]

      thirdSectionResults.forEach(function (d) {
        d.dropOut = d.dropOut == 1 ? 1 : d.Delegates == 0 ? 1 : d.Delegates < 150 ? Math.random() < 100 ? 1 : 0 : 0;
        return d;
      })

      //mar. 18 - Apr. 28

      var fourthSection = dataadj.slice(30, 44)


      var fourthSection = fourthSection.map((d, k) => {
        d.Bidenstd = 22
        d.Bloombergstd = 22
        d.Buttigiegstd = 22
        d.Klobucharstd = 22
        d.Sandersstd = 22
        d.Steyerstd = 22
        d.Warrenstd = 22
        d.Yangstd = 22
        d.Bidenvoteraw = thirdSectionResults[0].dropOut == 1 ? 0 : jStat.normal.inv((Bidensimulation * 3 + Math.random()) / 4, d.Bidenproj, d.Bidenstd);
        d.Bloombergvoteraw = thirdSectionResults[1].dropOut == 1 ? 0 : jStat.normal.inv((Bloombergsimulation * 3 + Math.random()) / 4, d.Bloombergproj, d.Bloombergstd);
        d.Buttigiegvoteraw = thirdSectionResults[2].dropOut == 1 ? 0 : jStat.normal.inv((Buttigiegsimulation * 3 + Math.random()) / 4, d.Buttigiegproj, d.Buttigiegstd);
        d.Klobucharvoteraw = thirdSectionResults[3].dropOut == 1 ? 0 : jStat.normal.inv((Klobucharsimulation * 3 + Math.random()) / 4, d.Klobucharproj, d.Klobucharstd);
        d.Sandersvoteraw = thirdSectionResults[4].dropOut == 1 ? 0 : jStat.normal.inv((Sanderssimulation * 3 + Math.random()) / 4, d.Sandersproj, d.Sandersstd);
        d.Steyervoteraw = thirdSectionResults[5].dropOut == 1 ? 0 : jStat.normal.inv((Steyersimulation * 3 + Math.random()) / 4, d.Steyerproj, d.Steyerstd);
        d.Warrenvoteraw = thirdSectionResults[6].dropOut == 1 ? 0 : jStat.normal.inv((Warrensimulation * 3 + Math.random()) / 4, d.Warrenproj, d.Warrenstd);
        d.Yangvoteraw = thirdSectionResults[7].dropOut == 1 ? 0 : jStat.normal.inv((Yangsimulation * 3 + Math.random()) / 4, d.Yangproj, d.Yangstd);
        d.Bidenvoteraw = d.Bidenvoteraw > 0 ? d.Bidenvoteraw : 0;
        d.Bloombergvoteraw = d.Bloombergvoteraw > 0 ? d.Bloombergvoteraw : 0;
        d.Buttigiegvoteraw = d.Buttigiegvoteraw > 0 ? d.Buttigiegvoteraw : 0;
        d.Klobucharvoteraw = d.Klobucharvoteraw > 0 ? d.Klobucharvoteraw : 0;
        d.Sandersvoteraw = d.Sandersvoteraw > 0 ? d.Sandersvoteraw : 0;
        d.Steyervoteraw = d.Steyervoteraw > 0 ? d.Steyervoteraw : 0;
        d.Warrenvoteraw = d.Warrenvoteraw > 0 ? d.Warrenvoteraw : 0;
        d.Yangvoteraw = d.Yangvoteraw > 0 ? d.Yangvoteraw : 0;
        d.sumvoteraw = d.Bidenvoteraw + d.Bloombergvoteraw + d.Buttigiegvoteraw + d.Klobucharvoteraw + d.Sandersvoteraw + d.Steyervoteraw + d.Warrenvoteraw + d.Yangvoteraw
        d.candsabove0 = (d.Bidenvoteraw > 0 ? 1 : 0) + (d.Bloombergvoteraw > 0 ? 1 : 0) + (d.Buttigiegvoteraw > 0 ? 1 : 0) + (d.Klobucharvoteraw > 0 ? 1 : 0) + (d.Sandersvoteraw > 0 ? 1 : 0) + (d.Steyervoteraw > 0 ? 1 : 0) + (d.Warrenvoteraw > 0 ? 1 : 0) + (d.Yangvoteraw > 0 ? 1 : 0)
        d.sumdistribute = (100 - d.sumvoteraw) / 2
        d.distributeper = d.sumdistribute / d.candsabove0
        d.Bidenvote = d.Bidenvoteraw == 0 ? 0 : d.Bidenvoteraw + d.distributeper + ((d.Bidenvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Bloombergvote = d.Bloombergvoteraw == 0 ? 0 : d.Bloombergvoteraw + d.distributeper + ((d.Bloombergvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Buttigiegvote = d.Buttigiegvoteraw == 0 ? 0 : d.Buttigiegvoteraw + d.distributeper + ((d.Buttigiegvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Klobucharvote = d.Klobucharvoteraw == 0 ? 0 : d.Klobucharvoteraw + d.distributeper + ((d.Klobucharvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Sandersvote = d.Sandersvoteraw == 0 ? 0 : d.Sandersvoteraw + d.distributeper + ((d.Sandersvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Steyervote = d.Steyervoteraw == 0 ? 0 : d.Steyervoteraw + d.distributeper + ((d.Steyervoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Warrenvote = d.Warrenvoteraw == 0 ? 0 : d.Warrenvoteraw + d.distributeper + ((d.Warrenvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Yangvote = d.Yangvoteraw == 0 ? 0 : d.Yangvoteraw + d.distributeper + ((d.Yangvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Bidenov15 = d.Bidenvote > 15 ? d.Bidenvote : 0
        d.Bloombergov15 = d.Bloombergvote > 15 ? d.Bloombergvote : 0
        d.Buttigiegov15 = d.Buttigiegvote > 15 ? d.Buttigiegvote : 0
        d.Klobucharov15 = d.Klobucharvote > 15 ? d.Klobucharvote : 0
        d.Sandersov15 = d.Sandersvote > 15 ? d.Sandersvote : 0
        d.Steyerov15 = d.Steyervote > 15 ? d.Steyervote : 0
        d.Warrenov15 = d.Warrenvote > 15 ? d.Warrenvote : 0
        d.Yangov15 = d.Yangvote > 15 ? d.Yangvote : 0
        d.sumover15 = d.Bidenov15 + d.Bloombergov15 + d.Buttigiegov15 + d.Klobucharov15 + d.Sandersov15 + d.Steyerov15 + d.Warrenov15 + d.Yangov15
        d.Bidendelegateun15 = d.Bidenov15 == 0 ? Math.round((300 * Math.pow(d.Bidenvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Bloombergdelegateun15 = d.Bloombergov15 == 0 ? Math.round((300 * Math.pow(d.Bloombergvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Buttigiegdelegateun15 = d.Buttigiegov15 == 0 ? Math.round((300 * Math.pow(d.Buttigiegvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Klobuchardelegateun15 = d.Klobcharov15 == 0 ? Math.round((300 * Math.pow(d.Klobucharvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Sandersdelegateun15 = d.Sandersov15 == 0 ? Math.round((300 * Math.pow(d.Sandersvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Steyerdelegateun15 = d.Steyerov15 == 0 ? Math.round((300 * Math.pow(d.Steyervote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Warrendelegateun15 = d.Warrenov15 == 0 ? Math.round((300 * Math.pow(d.Warrenvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Yangdelegateun15 = d.Yangov15 == 0 ? Math.round((300 * Math.pow(d.Yangvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.over15delegates = d.delegates - d.Bidendelegateun15 - d.Bloombergdelegateun15 - d.Buttigiegdelegateun15 - d.Klobuchardelegateun15 - d.Sandersdelegateun15 - d.Steyerdelegateun15 - d.Warrendelegateun15 - d.Yangdelegateun15
        d.Bidendelegateover15 = Math.round((d.Bidenov15 / d.sumover15) * d.over15delegates)
        d.Bloombergdelegateover15 = Math.round((d.Bloombergov15 / d.sumover15) * d.over15delegates)
        d.Buttigiegdelegateover15 = Math.round((d.Buttigiegov15 / d.sumover15) * d.over15delegates)
        d.Klobuchardelegateover15 = Math.round((d.Klobucharov15 / d.sumover15) * d.over15delegates)
        d.Sandersdelegateover15 = Math.round((d.Sandersov15 / d.sumover15) * d.over15delegates)
        d.Steyerdelegateover15 = Math.round((d.Steyerov15 / d.sumover15) * d.over15delegates)
        d.Warrendelegateover15 = Math.round((d.Warrenov15 / d.sumover15) * d.over15delegates)
        d.Yangdelegateover15 = Math.round((d.Yangov15 / d.sumover15) * d.over15delegates)
        d.Bidendelegates = d.Bidendelegateover15 + d.Bidendelegateun15
        d.Bloombergdelegates = d.Bloombergdelegateover15 + d.Bloombergdelegateun15
        d.Buttigiegdelegates = d.Buttigiegdelegateover15 + d.Buttigiegdelegateun15
        d.Klobuchardelegates = d.Klobuchardelegateover15 + d.Klobuchardelegateun15
        d.Sandersdelegates = d.Sandersdelegateover15 + d.Sandersdelegateun15
        d.Steyerdelegates = d.Steyerdelegateover15 + d.Steyerdelegateun15
        d.Warrendelegates = d.Warrendelegateover15 + d.Warrendelegateun15
        d.Yangdelegates = d.Yangdelegateover15 + d.Yangdelegateun15

        return d;
      })

      var fourthSectionResults = [{ Candidate: "Biden", Delegates: d3.sum(fourthSection, d => d.Bidendelegates), dropOut: thirdSectionResults[0].dropOut },
      { Candidate: "Bloomberg", Delegates: d3.sum(fourthSection, d => d.Bloombergdelegates), dropOut: thirdSectionResults[1].dropOut },
      { Candidate: "Buttigieg", Delegates: d3.sum(fourthSection, d => d.Buttigiegdelegates), dropOut: thirdSectionResults[2].dropOut },
      { Candidate: "Klobuchar", Delegates: d3.sum(fourthSection, d => d.Klobuchardelegates), dropOut: thirdSectionResults[3].dropOut },
      { Candidate: "Sanders", Delegates: d3.sum(fourthSection, d => d.Sandersdelegates), dropOut: thirdSectionResults[4].dropOut },
      { Candidate: "Steyer", Delegates: d3.sum(fourthSection, d => d.Steyerdelegates), dropOut: thirdSectionResults[5].dropOut },
      { Candidate: "Warren", Delegates: d3.sum(fourthSection, d => d.Warrendelegates), dropOut: thirdSectionResults[6].dropOut },
      { Candidate: "Yang", Delegates: d3.sum(fourthSection, d => d.Yangdelegates), dropOut: thirdSectionResults[7].dropOut },
      ]

      fourthSectionResults.forEach(function (d) {
        d.dropOut = d.dropOut == 1 ? 1 : d.Delegates == 0 ? 1 : d.Delegates < 300 ? Math.random() < 1 ? 1 : 0 : 0;
        return d;
      })

      //final

      var finalSection = dataadj.slice(44, 57)


      var finalSection = finalSection.map((d, k) => {
        d.Bidenstd = 23
        d.Bloombergstd = 23
        d.Buttigiegstd = 23
        d.Klobucharstd = 23
        d.Sandersstd = 23
        d.Steyerstd = 23
        d.Warrenstd = 23
        d.Yangstd = 23
        d.Bidenvoteraw = fourthSectionResults[0].dropOut == 1 ? 0 : jStat.normal.inv((Bidensimulation * 3 + Math.random()) / 4, d.Bidenproj, d.Bidenstd);
        d.Bloombergvoteraw = fourthSectionResults[1].dropOut == 1 ? 0 : jStat.normal.inv((Bloombergsimulation * 3 + Math.random()) / 4, d.Bloombergproj, d.Bloombergstd);
        d.Buttigiegvoteraw = fourthSectionResults[2].dropOut == 1 ? 0 : jStat.normal.inv((Buttigiegsimulation * 3 + Math.random()) / 4, d.Buttigiegproj, d.Buttigiegstd);
        d.Klobucharvoteraw = fourthSectionResults[3].dropOut == 1 ? 0 : jStat.normal.inv((Klobucharsimulation * 3 + Math.random()) / 4, d.Klobucharproj, d.Klobucharstd);
        d.Sandersvoteraw = fourthSectionResults[4].dropOut == 1 ? 0 : jStat.normal.inv((Sanderssimulation * 3 + Math.random()) / 4, d.Sandersproj, d.Sandersstd);
        d.Steyervoteraw = fourthSectionResults[5].dropOut == 1 ? 0 : jStat.normal.inv((Steyersimulation * 3 + Math.random()) / 4, d.Steyerproj, d.Steyerstd);
        d.Warrenvoteraw = fourthSectionResults[6].dropOut == 1 ? 0 : jStat.normal.inv((Warrensimulation * 3 + Math.random()) / 4, d.Warrenproj, d.Warrenstd);
        d.Yangvoteraw = fourthSectionResults[7].dropOut == 1 ? 0 : jStat.normal.inv((Yangsimulation * 3 + Math.random()) / 4, d.Yangproj, d.Yangstd);
        d.Bidenvoteraw = d.Bidenvoteraw > 0 ? d.Bidenvoteraw : 0;
        d.Bloombergvoteraw = d.Bloombergvoteraw > 0 ? d.Bloombergvoteraw : 0;
        d.Buttigiegvoteraw = d.Buttigiegvoteraw > 0 ? d.Buttigiegvoteraw : 0;
        d.Klobucharvoteraw = d.Klobucharvoteraw > 0 ? d.Klobucharvoteraw : 0;
        d.Sandersvoteraw = d.Sandersvoteraw > 0 ? d.Sandersvoteraw : 0;
        d.Steyervoteraw = d.Steyervoteraw > 0 ? d.Steyervoteraw : 0;
        d.Warrenvoteraw = d.Warrenvoteraw > 0 ? d.Warrenvoteraw : 0;
        d.Yangvoteraw = d.Yangvoteraw > 0 ? d.Yangvoteraw : 0;
        d.sumvoteraw = d.Bidenvoteraw + d.Bloombergvoteraw + d.Buttigiegvoteraw + d.Klobucharvoteraw + d.Sandersvoteraw + d.Steyervoteraw + d.Warrenvoteraw + d.Yangvoteraw
        d.candsabove0 = (d.Bidenvoteraw > 0 ? 1 : 0) + (d.Bloombergvoteraw > 0 ? 1 : 0) + (d.Buttigiegvoteraw > 0 ? 1 : 0) + (d.Klobucharvoteraw > 0 ? 1 : 0) + (d.Sandersvoteraw > 0 ? 1 : 0) + (d.Steyervoteraw > 0 ? 1 : 0) + (d.Warrenvoteraw > 0 ? 1 : 0) + (d.Yangvoteraw > 0 ? 1 : 0)
        d.sumdistribute = (100 - d.sumvoteraw) / 2
        d.distributeper = d.sumdistribute / d.candsabove0
        d.Bidenvote = d.Bidenvoteraw == 0 ? 0 : d.Bidenvoteraw + d.distributeper + ((d.Bidenvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Bloombergvote = d.Bloombergvoteraw == 0 ? 0 : d.Bloombergvoteraw + d.distributeper + ((d.Bloombergvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Buttigiegvote = d.Buttigiegvoteraw == 0 ? 0 : d.Buttigiegvoteraw + d.distributeper + ((d.Buttigiegvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Klobucharvote = d.Klobucharvoteraw == 0 ? 0 : d.Klobucharvoteraw + d.distributeper + ((d.Klobucharvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Sandersvote = d.Sandersvoteraw == 0 ? 0 : d.Sandersvoteraw + d.distributeper + ((d.Sandersvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Steyervote = d.Steyervoteraw == 0 ? 0 : d.Steyervoteraw + d.distributeper + ((d.Steyervoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Warrenvote = d.Warrenvoteraw == 0 ? 0 : d.Warrenvoteraw + d.distributeper + ((d.Warrenvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Yangvote = d.Yangvoteraw == 0 ? 0 : d.Yangvoteraw + d.distributeper + ((d.Yangvoteraw / ((d.sumvoteraw / 100))) * (d.sumdistribute / 100))
        d.Bidenov15 = d.Bidenvote > 15 ? d.Bidenvote : 0
        d.Bloombergov15 = d.Bloombergvote > 15 ? d.Bloombergvote : 0
        d.Buttigiegov15 = d.Buttigiegvote > 15 ? d.Buttigiegvote : 0
        d.Klobucharov15 = d.Klobucharvote > 15 ? d.Klobucharvote : 0
        d.Sandersov15 = d.Sandersvote > 15 ? d.Sandersvote : 0
        d.Steyerov15 = d.Steyervote > 15 ? d.Steyervote : 0
        d.Warrenov15 = d.Warrenvote > 15 ? d.Warrenvote : 0
        d.Yangov15 = d.Yangvote > 15 ? d.Yangvote : 0
        d.sumover15 = d.Bidenov15 + d.Bloombergov15 + d.Buttigiegov15 + d.Klobucharov15 + d.Sandersov15 + d.Steyerov15 + d.Warrenov15 + d.Yangov15
        d.Bidendelegateun15 = d.Bidenov15 == 0 ? Math.round((300 * Math.pow(d.Bidenvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Bloombergdelegateun15 = d.Bloombergov15 == 0 ? Math.round((300 * Math.pow(d.Bloombergvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Buttigiegdelegateun15 = d.Buttigiegov15 == 0 ? Math.round((300 * Math.pow(d.Buttigiegvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Klobuchardelegateun15 = d.Klobcharov15 == 0 ? Math.round((300 * Math.pow(d.Klobucharvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Sandersdelegateun15 = d.Sandersov15 == 0 ? Math.round((300 * Math.pow(d.Sandersvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Steyerdelegateun15 = d.Steyerov15 == 0 ? Math.round((300 * Math.pow(d.Steyervote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Warrendelegateun15 = d.Warrenov15 == 0 ? Math.round((300 * Math.pow(d.Warrenvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.Yangdelegateun15 = d.Yangov15 == 0 ? Math.round((300 * Math.pow(d.Yangvote / 100, 4) - 0.0006) * d.delegates) : 0;
        d.over15delegates = d.delegates - d.Bidendelegateun15 - d.Bloombergdelegateun15 - d.Buttigiegdelegateun15 - d.Klobuchardelegateun15 - d.Sandersdelegateun15 - d.Steyerdelegateun15 - d.Warrendelegateun15 - d.Yangdelegateun15
        d.Bidendelegateover15 = Math.round((d.Bidenov15 / d.sumover15) * d.over15delegates)
        d.Bloombergdelegateover15 = Math.round((d.Bloombergov15 / d.sumover15) * d.over15delegates)
        d.Buttigiegdelegateover15 = Math.round((d.Buttigiegov15 / d.sumover15) * d.over15delegates)
        d.Klobuchardelegateover15 = Math.round((d.Klobucharov15 / d.sumover15) * d.over15delegates)
        d.Sandersdelegateover15 = Math.round((d.Sandersov15 / d.sumover15) * d.over15delegates)
        d.Steyerdelegateover15 = Math.round((d.Steyerov15 / d.sumover15) * d.over15delegates)
        d.Warrendelegateover15 = Math.round((d.Warrenov15 / d.sumover15) * d.over15delegates)
        d.Yangdelegateover15 = Math.round((d.Yangov15 / d.sumover15) * d.over15delegates)
        d.Bidendelegates = d.Bidendelegateover15 + d.Bidendelegateun15
        d.Bloombergdelegates = d.Bloombergdelegateover15 + d.Bloombergdelegateun15
        d.Buttigiegdelegates = d.Buttigiegdelegateover15 + d.Buttigiegdelegateun15
        d.Klobuchardelegates = d.Klobuchardelegateover15 + d.Klobuchardelegateun15
        d.Sandersdelegates = d.Sandersdelegateover15 + d.Sandersdelegateun15
        d.Steyerdelegates = d.Steyerdelegateover15 + d.Steyerdelegateun15
        d.Warrendelegates = d.Warrendelegateover15 + d.Warrendelegateun15
        d.Yangdelegates = d.Yangdelegateover15 + d.Yangdelegateun15

        return d;
      })

      var finalSectionResults = [{ Candidate: "Biden", Delegates: d3.sum(finalSection, d => d.Bidendelegates), dropOut: fourthSectionResults[0].dropOut },
      { Candidate: "Bloomberg", Delegates: d3.sum(finalSection, d => d.Bloombergdelegates), dropOut: fourthSectionResults[1].dropOut },
      { Candidate: "Buttigieg", Delegates: d3.sum(finalSection, d => d.Buttigiegdelegates), dropOut: fourthSectionResults[2].dropOut },
      { Candidate: "Klobuchar", Delegates: d3.sum(finalSection, d => d.Klobuchardelegates), dropOut: fourthSectionResults[3].dropOut },
      { Candidate: "Sanders", Delegates: d3.sum(finalSection, d => d.Sandersdelegates), dropOut: fourthSectionResults[4].dropOut },
      { Candidate: "Steyer", Delegates: d3.sum(finalSection, d => d.Steyerdelegates), dropOut: fourthSectionResults[5].dropOut },
      { Candidate: "Warren", Delegates: d3.sum(finalSection, d => d.Warrendelegates), dropOut: fourthSectionResults[6].dropOut },
      { Candidate: "Yang", Delegates: d3.sum(finalSection, d => d.Yangdelegates), dropOut: fourthSectionResults[7].dropOut },
      ]

      finalSectionResults.forEach(function (d) {
        d.dropOut = d.dropOut == 1 ? 1 : d.Delegates == 0 ? 1 : d.Delegates < 0 ? Math.random() < 50 ? 1 : 0 : 0;
        return d;
      })






      var rawsimulation = firstSection.concat(secondSection)
      var rawsimulation = rawsimulation.concat(thirdSection)
      var rawsimulation = rawsimulation.concat(fourthSection)
      var rawsimulation = rawsimulation.concat(finalSection)
      rawsimulation.forEach(function (d) {
        d.Bidentotvote = d.Bidenvote * d.voteperc;
        d.Bloombergtotvote = d.Bloombergvote * d.voteperc;
        d.Buttigiegtotvote = d.Buttigiegvote * d.voteperc;
        d.Klobuchartotvote = d.Klobucharvote * d.voteperc;
        d.Sanderstotvote = d.Sandersvote * d.voteperc;
        d.Steyertotvote = d.Steyervote * d.voteperc;
        d.Warrentotvote = d.Warrenvote * d.voteperc;
        d.Yangtotvote = d.Yangvote * d.voteperc;
        return d;
      })

      var rawsimulation = rawsimulation.map((d, k) => {
        d.winner = Math.max(d.Bidenvote, d.Bloombergvote, d.Buttigiegvote, d.Klobucharvote, d.Sandersvote, d.Steyervote, d.Warrenvote, d.Yangvote)
        d.Bidenwin = d.winner == d.Bidenvote ? 1 : 0
        d.Bloombergwin = d.winner == d.Bloombergvote ? 1 : 0
        d.Buttigiegwin = d.winner == d.Buttigiegvote ? 1 : 0
        d.Klobucharwin = d.winner == d.Klobucharvote ? 1 : 0
        d.Sanderswin = d.winner == d.Sandersvote ? 1 : 0
        d.Steyerwin = d.winner == d.Steyervote ? 1 : 0
        d.Warrenwin = d.winner == d.Warrenvote ? 1 : 0
        d.Yangwin = d.winner == d.Yangvote ? 1 : 0
        d.winner = d.Bidenwin == 1 ? "Biden" : d.Bloombergwin == 1 ? "Bloomberg" : d.Buttigiegwin == 1 ? "Buttigieg" : d.Klobucharwin == 1 ? "Klobuchar" : d.Sanderswin == 1 ? "Sanders" : d.Steyerwin == 1 ? "Steyer" : d.Warrenwin == 1 ? "Warren" : "Yang"
        return d;
      })


      var simulation = rawsimulation.map((d, i) => {
        return {
          state: d.state,
          date: d.date,
          delegates: +d.delegates,
          winner: d.winner,
          Bidenvote: +d.Bidenvote,
          Bloombergvote: +d.Bloombergvote,
          Buttigiegvote: +d.Buttigiegvote,
          Klobucharvote: +d.Klobucharvote,
          Sandersvote: +d.Sandersvote,
          Steyervote: +d.Steyervote,
          Warrenvote: +d.Warrenvote,
          Yangvote: +d.Yangvote,
          Bidendelegates: +d.Bidendelegates,
          Bloombergdelegates: +d.Bloombergdelegates,
          Buttigiegdelegates: +d.Buttigiegdelegates,
          Klobuchardelegates: +d.Klobuchardelegates,
          Sandersdelegates: +d.Sandersdelegates,
          Steyerdelegates: +d.Steyerdelegates,
          Warrendelegates: +d.Warrendelegates,
          Yangdelegates: +d.Yangdelegates,
          Bidenwin: +d.Bidenwin,
          Bloombergwin: +d.Bloombergwin,
          Buttigiegwin: +d.Buttigiegwin,
          Klobucharwin: +d.Klobucharwin,
          Sanderswin: +d.Sanderswin,
          Steyerwin: +d.Steyerwin,
          Warrenwin: +d.Warrenwin,
          Yangwin: +d.Yangwin,
          Bidenpop: +d.Bidentotvote,
          Bloombergpop: +d.Bloombergtotvote,
          Buttigiegpop: +d.Buttigiegtotvote,
          Klobucharpop: +d.Klobuchartotvote,
          Sanderspop: +d.Sanderstotvote,
          Steyerpop: +d.Steyertotvote,
          Warrenpop: +d.Warrentotvote,
          Yangpop: +d.Yangtotvote,
          radius: data[i].radius,
          xValue: data[i].xValue,
          yValue: data[i].yValue,
          abbrev: data[i].abbrev
        }
      })

      //Final Results



      var Bidendelegates = d3.sum(simulation, d => d.Bidendelegates)
      Bloombergdelegates = d3.sum(simulation, d => d.Bloombergdelegates)
      Buttigiegdelegates = d3.sum(simulation, d => d.Buttigiegdelegates)
      Klobuchardelegates = d3.sum(simulation, d => d.Klobuchardelegates)
      Sandersdelegates = d3.sum(simulation, d => d.Sandersdelegates)
      Steyerdelegates = d3.sum(simulation, d => d.Steyerdelegates)
      Warrendelegates = d3.sum(simulation, d => d.Warrendelegates)
      Yangdelegates = d3.sum(simulation, d => d.Yangdelegates)

      Bidenpop = d3.sum(simulation, d => d.Bidenpop)
      Bloombergpop = d3.sum(simulation, d => d.Bloombergpop)
      Buttigiegpop = d3.sum(simulation, d => d.Buttigiegpop)
      Klobucharpop = d3.sum(simulation, d => d.Klobucharpop)
      Sanderspop = d3.sum(simulation, d => d.Sanderspop)
      Steyerpop = d3.sum(simulation, d => d.Steyerpop)
      Warrenpop = d3.sum(simulation, d => d.Warrenpop)
      Yangpop = d3.sum(simulation, d => d.Yangpop)

      nomwinner = Math.max(Bidendelegates, Bloombergdelegates, Buttigiegdelegates, Klobuchardelegates, Sandersdelegates, Steyerdelegates, Warrendelegates, Yangdelegates)
      Bidenwin = Bidendelegates == nomwinner ? 1 : 0
      Bloombergwin = Bloombergdelegates == nomwinner ? 1 : 0
      Buttigiegwin = Buttigiegdelegates == nomwinner ? 1 : 0
      Klobucharwin = Klobuchardelegates == nomwinner ? 1 : 0
      Sanderswin = Sandersdelegates == nomwinner ? 1 : 0
      Steyerwin = Steyerdelegates == nomwinner ? 1 : 0
      Warrenwin = Warrendelegates == nomwinner ? 1 : 0
      Yangwin = Yangdelegates == nomwinner ? 1 : 0
      nomwinner = Bidenwin == 1 ? "Biden" : Bloombergwin == 1 ? "Bloomberg" : Buttigiegwin == 1 ? "Buttigieg" : Klobucharwin == 1 ? "Klobuchar" : Sanderswin == 1 ? "Sanders" : Steyerwin == 1 ? "Steyer" : Warrenwin == 1 ? "Warren" : "Yang"



      var usa = {
        state: "US",
        date: new Date(2020, 6, 1),
        delegates: 3879,
        winner: nomwinner,
        Bidenvote: Bidenpop,
        Bloombergvote: Bloombergpop,
        Buttigiegvote: Buttigiegpop,
        Klobucharvote: Klobucharpop,
        Sandersvote: Sanderspop,
        Steyervote: Steyerpop,
        Warrenvote: Warrenpop,
        Yangvote: Yangpop,
        Bidendelegates: Bidendelegates,
        Bloombergdelegates: Bloombergdelegates,
        Buttigiegdelegates: Buttigiegdelegates,
        Klobuchardelegates: Klobuchardelegates,
        Sandersdelegates: Sandersdelegates,
        Steyerdelegates: Steyerdelegates,
        Warrendelegates: Warrendelegates,
        Yangdelegates: Yangdelegates,
        Bidenwin: Bidenwin,
        Bloombergwin: Bloombergwin,
        Buttigiegwin: Buttigiegwin,
        Klobucharwin: Klobucharwin,
        Sanderswin: Sanderswin,
        Steyerwin: Steyerwin,
        Warrenwin: Warrenwin,
        Yangwin: Yangwin,
        Bidenpop: Bidenpop,
        Bloombergpop: Bloombergpop,
        Buttigiegpop: Buttigiegpop,
        Klobucharpop: Klobucharpop,
        Sanderspop: Sanderspop,
        Steyerpop: Steyerpop,
        Warrenpop: Warrenpop,
        Yangpop: Yangpop,
      }

      var simulationnew = simulation


      console.log(simulationnew)


      var biden_final = {
        candidate: "Biden",
        delegates: usa.Bidendelegates,
        projected_vote: usa.Bidenvote
      }

      var bloomberg_final = {
        candidate: "Bloomberg",
        delegates: usa.Bloombergdelegates,
        projected_vote: usa.Bloombergvote
      }


      var buttigieg_final = {
        candidate: "Buttigieg",
        delegates: usa.Buttigiegdelegates,
        projected_vote: usa.Buttigiegvote
      }


      var klobuchar_final = {
        candidate: "Klobuchar",
        delegates: usa.Klobuchardelegates,
        projected_vote: usa.Klobucharvote
      }

      var sanders_final = {
        candidate: "Sanders",
        delegates: usa.Sandersdelegates,
        projected_vote: usa.Sandersvote
      }

      var steyer_final = {
        candidate: "Steyer",
        delegates: usa.Steyerdelegates,
        projected_vote: usa.Steyervote
      }
      var warren_final = {
        candidate: "Warren",
        delegates: usa.Warrendelegates,
        projected_vote: usa.Warrenvote
      }
      var yang_final = {
        candidate: "Yang",
        delegates: usa.Yangdelegates,
        projected_vote: usa.Yangvote
      }

      var finalresults = [biden_final, bloomberg_final, buttigieg_final,klobuchar_final,sanders_final,steyer_final,warren_final]

      finalresults.sort((a, b) => b.delegates - a.delegates)

      console.log(finalresults)


      var margin2 = { top: 0, right: 70, bottom: 0, left: 50 }
      width2 = 860 - margin2.left - margin2.right
      height2 = 445
      axisPad = 12
      R = 10
      category = ["Biden", "Bloomberg", "Buttigieg", "Klobuchar", "Sanders", "Steyer", "Warren", "Yang"]
      color = d3.scaleOrdinal()
        .domain(category)
        .range(["#00C181", "#FF6060", "#FFE130", "#FF8D32", "#0091FF", "#FF2EF0", "#AF0BFF", "#a4b1b5"])
      colortwo = d3.scaleOrdinal()
        .domain(category)
        .range(["black", "white", "white", "black", "white", "white", "black", "white", "white"])
      div = d3.select("#bubblemap").append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);

      var data = simulationnew

      console.log(data)

      var colorscale = d3.scaleLinear()
        .domain([0,20,50])
        .range(["#98d2f8", "#0091FF","#002E66"]);


      var x = d3.scaleLinear()
        .domain([0, 780])
        .range([0, width2])



      var y = d3.scaleLinear()
        .domain([0, 445])
        .range([0, height2]);



      var svg = d3.select("#bubblemap").append("svg")
        .attr("viewBox", '0 0 950 4300')
        .append('g')
        .attr("transform", "translate(" + margin2.left + "," + margin2.top + ")");



      var svgLegend = svg.append('g')
        .attr('class', 'gLegend')
        .attr("transform", "translate(" + 700 + "," + 30 + ")")

      var legend = svgLegend.selectAll('.legend')
        .data(category)
        .enter().append('g')
        .attr("class", "legend")
        .attr("transform", function (d, i) { return "translate(0," + i * 30 + ")" })

      legend.append("circle")
        .attr("class", "legend-node")
        .attr("cx", 0)
        .attr("cy", 0)
        .attr("r", R)
        .style("fill", d => color(d))

      legend.append("text")
        .attr("class", "legend-text")
        .attr("x", R * 2)
        .attr("y", R / 2)
        .style("fill", d => color(d))
        .style("font-size", 18)
        .style("font-weight", 500)
        .text(d => d)



      svg.selectAll("states")
        .data(data)
        .enter()
        .append("circle")
        .attr("cx", d => x(d.xValue))
        .attr("cy", d => y(d.yValue))
        .attr("r", d => d.radius)
        .style("fill", "white")
        .style("stroke","black")
        .transition()
        .delay( function(d,i){return 40*i})
        .style("fill", d => color(d.winner))
        .style("stroke","none")

      svg.selectAll("label")
        .data(data)
        .enter()
        .append("text")
        .text(d => d.abbrev)
        .attr("x", d => x(d.xValue))
        .attr("y", d => y(d.yValue) + 3)
        .attr("text-anchor", "middle")
        .attr("font-family", "brandon-grotesque")
        .attr("font-weight", 700)
        .attr("font-size", "8")
        .attr("fill", "us")





    


      var svgrepeat = svg.append('g')
        .attr('class', 'gLegend')
        .attr("transform", "translate(" + 30 + "," + 500 + ")")

      var repeat = svgrepeat.selectAll('.legend')
        .data(finalresults)
        .enter().append('g')
        .attr("class", "legend")
        .attr("transform", function (d, i) { return "translate(0," + i * 60 + ")" })



      repeat.append("a").attr("xlink:href", d => d.candidate).append("image")
    .attr("xlink:href", d => "https://raw.githubusercontent.com/jhkersting/home/master/" + d.candidate + "-01.png")
    .attr("x", 50)
    .attr("y", -30)
    .attr("height", 60)
    .attr("width", 60)
   

      repeat.append("text")
        .attr("class", "legend-text")
        .attr("x", 500)
        .attr("y", 0)
        .style("fill", d=>d.delegates>1990?"black" :"grey")
        .style("font-size", 30)
        .style("font-weight", 700)
        .text(d => d.delegates)
        .attr("text-anchor","end")

        repeat.append("text")
        .attr("class", "legend-text")
        .attr("x", 800)
        .attr("y", 0)
        .style("fill", d=>d.delegates>1990?"black" :"grey")
        .style("font-size", 30)
        .style("font-weight", 700)
        .text(d => d.projected_vote<1?">1%":d.projected_vote>10?formatvalue(d.projected_vote)+"%": formatValue(d.projected_vote)+"%")
        .attr("text-anchor","end")

        var svgstate = svg.append('g')
        .attr('class', 'gLegend')
        .attr("transform", "translate(" + 30 + "," + 1000 + ")")

      var state = svgstate.selectAll('.legend')
        .data(simulationnew)
        .enter().append('g')
        .attr("class", "legend")
        .attr("transform", function (d, i) { return "translate(0," + i * 60 + ")" })

        state.append("rect")
        .attr("x",215)
        .attr("y",-30)
        .attr("height",50)
        .attr("width",70)
        .attr("fill",d=>colorscale(d.Bidenvote))


        state.append("rect")
        .attr("x",290)
        .attr("y",-30)
        .attr("height",50)
        .attr("width",70)
        .attr("fill",d=>colorscale(d.Bloombergvote))
        
        state.append("rect")
        .attr("x",365)
        .attr("y",-30)
        .attr("height",50)
        .attr("width",70)
        .attr("fill",d=>colorscale(d.Buttigiegvote))

        state.append("rect")
        .attr("x",440)
        .attr("y",-30)
        .attr("height",50)
        .attr("width",70)
        .attr("fill",d=>colorscale(d.Klobucharvote))

        state.append("rect")
        .attr("x",515)
        .attr("y",-30)
        .attr("height",50)
        .attr("width",70)
        .attr("fill",d=>colorscale(d.Sandersvote))

        state.append("rect")
        .attr("x",590)
        .attr("y",-30)
        .attr("height",50)
        .attr("width",70)
        .attr("fill",d=>colorscale(d.Steyervote))

        state.append("rect")
        .attr("x",665)
        .attr("y",-30)
        .attr("height",50)
        .attr("width",70)
        .attr("fill",d=>colorscale(d.Warrenvote))
        state.append("rect")
        .attr("x",740)
        .attr("y",-30)
        .attr("height",50)
        .attr("width",70)
        .attr("fill",d=>colorscale(d.Yangvote))

      state.append("text")
        .attr("class", "legend-text")
        .attr("x", 0)
        .attr("y", 0)
        .style("fill", "black")
        .style("font-size", 20)
        .style("font-weight", 700)
        .text(d => d.state)

        state.append("text")
        .attr("class", "legend-text")
        .attr("x", 250)
        .attr("y", -15)
        .style("fill",d=> d.Bidenvote>25?"white":"black")
        .style("font-size", 15)
        .style("font-weight", 700)
        .text(d => d.Bidenvote<1?"<1%":formatValue(d.Bidenvote)+"%")
        .attr("text-anchor","middle")

        state.append("text")
        .attr("class", "legend-text")
        .attr("x", 325)
        .attr("y", -15)
        .style("fill",d=> d.Bloombergvote>25?"white":"black")
        .style("font-size", 15)
        .style("font-weight", 700)
        .text(d => d.Bloombergvote<1?"<1%":formatValue(d.Bloombergvote)+"%")
        .attr("text-anchor","middle")

        state.append("text")
        .attr("class", "legend-text")
        .attr("x", 400)
        .attr("y", -15)
        .style("fill",d=> d.Buttigiegvote>25?"white":"black")
        .style("font-size", 15)
        .style("font-weight", 700)
        .text(d => d.Buttigiegvote<1?"<1%":formatValue(d.Buttigiegvote)+"%")
        .attr("text-anchor","middle")


        state.append("text")
        .attr("class", "legend-text")
        .attr("x", 475)
        .attr("y", -15)
        .style("fill",d=> d.Klobucharvote>25?"white":"black")
        .style("font-size",15)
        .style("font-weight", 700)
        .text(d => d.Klobucharvote<1?"<1%":formatValue(d.Klobucharvote)+"%")
        .attr("text-anchor","middle")

        state.append("text")
        .attr("class", "legend-text")
        .attr("x", 550)
        .attr("y", -15)
        .style("fill",d=> d.Sandersvote>25?"white":"black")
        .style("font-size", 15)
        .style("font-weight", 700)
        .text(d => d.Sandersvote<1?"<1%":formatValue(d.Sandersvote)+"%")
        .attr("text-anchor","middle")

        state.append("text")
        .attr("class", "legend-text")
        .attr("x", 625)
        .attr("y", -15)
        .style("fill",d=> d.Steyervote>25?"white":"black")
        .style("font-size", 15)
        .style("font-weight", 700)
        .text(d => d.Steyervote<1?"<1%":formatValue(d.Steyervote)+"%")
        .attr("text-anchor","middle")


        state.append("text")
        .attr("class", "legend-text")
        .attr("x", 700)
        .attr("y", -15)
        .style("fill",d=> d.Warrenvote>25?"white":"black")        .style("font-size", 15)
        .style("font-weight", 700)
        .text(d => d.Warrenvote<1?"<1%":formatValue(d.Warrenvote)+"%")
        .attr("text-anchor","middle")

        state.append("text")
        .attr("class", "legend-text")
        .attr("x", 775)
        .attr("y", -15)
        .style("fill",d=> d.Yangvote>25?"white":"black")
        .style("font-size", 15)
        .style("font-weight", 700)
        .text(d => d.Yangvote<1?"<1%":formatValue(d.Yangvote)+"%")
        .attr("text-anchor","middle")

        state.append("text")
        .attr("class", "legend-text")
        .attr("x", 250)
        .attr("y", 15)
        .style("fill",d=> d.Bidenvote>25?"white":"black")
        .style("font-size", 15)
        .style("font-weight", 700)
        .text(d => d.Bidendelegates)
        .attr("text-anchor","middle")

        state.append("text")
        .attr("class", "legend-text")
        .attr("x", 325)
        .attr("y", 15)
        .style("fill",d=> d.Bloombergvote>25?"white":"black")
        .style("font-size", 15)
        .style("font-weight", 700)
        .text(d => d.Bloombergdelegates)
        .attr("text-anchor","middle")

        state.append("text")
        .attr("class", "legend-text")
        .attr("x", 400)
        .attr("y", 15)
        .style("fill",d=> d.Buttigiegvote>25?"white":"black")        .style("font-size", 15)
        .style("font-weight", 700)
        .text(d => d.Buttigiegdelegates)
        .attr("text-anchor","middle")

        state.append("text")
        .attr("class", "legend-text")
        .attr("x", 475)
        .attr("y", 15)
        .style("fill",d=> d.Klobucharvote>25?"white":"black") 
        .style("font-size", 15)
        .style("font-weight", 700)
        .text(d => d.Klobuchardelegates)
        .attr("text-anchor","middle")

        state.append("text")
        .attr("class", "legend-text")
        .attr("x", 550)
        .attr("y", 15)
        .style("fill",d=> d.Sandersvote>25?"white":"black") 
        .style("font-size", 15)
        .style("font-weight", 700)
        .text(d => d.Sandersdelegates)
        .attr("text-anchor","middle")

        state.append("text")
        .attr("class", "legend-text")
        .attr("x", 625)
        .attr("y", 15)
        .style("fill",d=> d.Steyervote>25?"white":"black") 
        .style("font-size", 15)
        .style("font-weight", 700)
        .text(d => d.Steyerdelegates)
        .attr("text-anchor","middle")

        state.append("text")
        .attr("class", "legend-text")
        .attr("x", 700)
        .attr("y", 15)
        .style("fill",d=> d.Warrenvote>25?"white":"black") 
        .style("font-size", 15)
        .style("font-weight", 700)
        .text(d => d.Warrendelegates)
        .attr("text-anchor","middle")

        state.append("text")
        .attr("class", "legend-text")
        .attr("x", 775)
        .attr("y", 15)
        .style("fill",d=> d.Yangvote>25?"white":"black") 
        .style("font-size", 15)
        .style("font-weight", 700)
        .text(d => d.Yangdelegates)
        .attr("text-anchor","middle")

        svg.append("text")
        .attr("class", "legend-text")
        .attr("x", 30)
        .attr("y", 450)
        .style("fill", "black")
        .style("font-size", 30)
        .style("font-weight", 700)
        .text("Candidate")
        .attr("text-anchor","start")


        svg.append("text")
        .attr("class", "legend-text")
        .attr("x", 530)
        .attr("y", 450)
        .style("fill", "black")
        .style("font-size", 30)
        .style("font-weight", 700)
        .text("Delegates")
        .attr("text-anchor","end")

        svg.append("text")
        .attr("class", "legend-text")
        .attr("x", 830)
        .attr("y", 450)
        .style("fill", "black")
        .style("font-size", 30)
        .style("font-weight", 700)
        .text("Vote Share")
        .attr("text-anchor","end")

        svg.append("text")
        .attr("class", "legend-text")
        .attr("x", 30)
        .attr("y", 950)
        .style("fill", "black")
        .style("font-size", 20)
        .style("font-weight", 700)
        .text("State")
        .attr("text-anchor","start")


        svg.append("text")
        .attr("class", "legend-text")
        .attr("x", 280)
        .attr("y", 950)
        .style("fill", "black")
        .style("font-size", 15)
        .style("font-weight", 700)
        .text("Biden")
        .attr("text-anchor","middle")

        svg.append("text")
        .attr("class", "legend-text")
        .attr("x", 355)
        .attr("y", 950)
        .style("fill", "black")
        .style("font-size", 15)
        .style("font-weight", 700)
        .text("Bloomberg")
        .attr("text-anchor","middle")


        svg.append("text")
        .attr("class", "legend-text")
        .attr("x", 430)
        .attr("y", 950)
        .style("fill", "black")
        .style("font-size", 15)
        .style("font-weight", 700)
        .text("Buttigieg")
        .attr("text-anchor","middle")

        svg.append("text")
        .attr("class", "legend-text")
        .attr("x", 505)
        .attr("y", 950)
        .style("fill", "black")
        .style("font-size", 15)
        .style("font-weight", 700)
        .text("Klobuchar")
        .attr("text-anchor","middle")

        svg.append("text")
        .attr("class", "legend-text")
        .attr("x", 580)
        .attr("y", 950)
        .style("fill", "black")
        .style("font-size", 15)
        .style("font-weight", 700)
        .text("Sanders")
        .attr("text-anchor","middle")

        svg.append("text")
        .attr("class", "legend-text")
        .attr("x", 655)
        .attr("y", 950)
        .style("fill", "black")
        .style("font-size", 15)
        .style("font-weight", 700)
        .text("Steyer")
        .attr("text-anchor","middle")

        svg.append("text")
        .attr("class", "legend-text")
        .attr("x", 730)
        .attr("y", 950)
        .style("fill", "black")
        .style("font-size", 15)
        .style("font-weight", 700)
        .text("Warren")
        .attr("text-anchor","middle")

        svg.append("text")
        .attr("class", "legend-text")
        .attr("x", 805)
        .attr("y", 950)
        .style("fill", "black")
        .style("font-size", 15)
        .style("font-weight", 700)
        .text("Yang")
        .attr("text-anchor","middle")

        svg.append("text")
        .attr("class", "legend-text")
        .attr("x", 230)
        .attr("y", 985)
        .style("fill", "black")
        .style("font-size", 15)
        .style("font-weight", 700)
        .text("Vote")
        .attr("text-anchor","end")

        svg.append("text")
        .attr("class", "legend-text")
        .attr("x", 230)
        .attr("y", 1015)
        .style("fill", "black")
        .style("font-size", 15)
        .style("font-weight", 700)
        .text("Delegates")
        .attr("text-anchor","end")



        



        svg.append("line")
        .attr("x1",30)
        .attr("x2",830)
        .attr("y1",470)
        .attr("y2",470)
        .attr("stroke","black")


       

        svg.append("line")
        .attr("x1",-100)
        .attr("x2",840)
        .attr("y1",965)
        .attr("y2",965)
        .attr("stroke","black")

        svg.append("text")
        .attr("class", "legend-text")
        .attr("x", -40)
        .attr("y", 985)
        .style("fill", "black")
        .style("font-size", 12)
        .style("font-weight", 500)
        .text("Feb 3rd")
        .attr("text-anchor","start")
    

        svg.append("line")
        .attr("x1",-100)
        .attr("x2",840)
        .attr("y1",1025)
        .attr("y2",1025)
        .attr("stroke","black")

        svg.append("text")
        .attr("class", "legend-text")
        .attr("x", -40)
        .attr("y", 1045)
        .style("fill", "black")
        .style("font-size", 12)
        .style("font-weight", 500)
        .text("Feb 11th")
        .attr("text-anchor","start")

        svg.append("line")
        .attr("x1",-100)
        .attr("x2",840)
        .attr("y1",1085)
        .attr("y2",1085)
        .attr("stroke","black")

        svg.append("text")
        .attr("class", "legend-text")
        .attr("x", -40)
        .attr("y", 1105)
        .style("fill", "black")
        .style("font-size", 12)
        .style("font-weight", 500)
        .text("Feb 22nd")
        .attr("text-anchor","start")

        svg.append("line")
        .attr("x1",-100)
        .attr("x2",840)
        .attr("y1",1145)
        .attr("y2",1145)
        .attr("stroke","black")

        svg.append("text")
        .attr("class", "legend-text")
        .attr("x", -40)
        .attr("y", 1165)
        .style("fill", "black")
        .style("font-size", 12)
        .style("font-weight", 500)
        .text("Feb 29th")
        .attr("text-anchor","start")
    
    
    
      })








      ;</script>

</body>

</html>