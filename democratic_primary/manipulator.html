<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@jhkforecast">
  <meta name="twitter:creator" content="@jhkersting">
  <meta name="twitter:title" content="Democratic Primary manipulator">
  <meta name="twitter:description" content="Change the vote fore yourself!">
  <meta name="twitter:image" content="https://jhkforecasts.com/democratic_primary-02.png">
  <title>Democratic Primary Manipulator</title>
  <script data-ad-client="ca-pub-8025120308040073" async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140782021-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-140782021-2');
  </script>
  <script data-ad-client="ca-pub-8025120308040073" async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <link rel="icon" href="https://jkstats76.files.wordpress.com/2019/02/cropped-site-icon.png?w=32" sizes="32x32">
  <link rel="icon" href="https://jkstats76.files.wordpress.com/2019/02/cropped-site-icon.png?w=192" sizes="192x192">

  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.1/d3-tip.min.js"></script>
  <link rel="stylesheet" href="https://use.typekit.net/htk2wjy.css">
  <link rel="stylesheet" href="index.css">
<style>
  @media only screen and (min-width:851px) {
  #bubblemap {
    width: 80%;
    margin-left: 10%;
  }
}
</style>
</head>
<a href="https://jhkforecasts.com">
  <h1 style="font-weight: 300;text-align: center;">JHK Forecasts</h1>
</a>


<div id="bigmenu">
  <table style="border-collapse: collapse; border: none;margin-top: 20px;" cellspacing="0" cellpadding="0" width="100%"
    height=100px>
    <tbody>
      <tr>
        <td style="width: 33%; border-right: solid grey 1.0pt; " valign="middle" width="33%">
          <a href="https://projects.jhkforecasts.com/democratic_primary/">
            <img style="text-align: center;" src="demprimarymenu-01.svg">
          </a>
        </td>
        <td style="width: 33%; border-right: solid grey 1.0pt; border-left: none; " valign="middle" width="33%">
          <a href="https://projects.jhkforecasts.com/presidential_forecast/">
            <img style="text-align: center;" src="presforecastmenu-01.svg">
        </td>
        <td style="width: 33%; ; " valign="middle" width="33%">
          <a href="https://projects.jhkforecasts.com/senate_forecast/">
            <img style="text-align: center;" src="senateforecastmenu-01.svg">
        </td>
      </tr>
    </tbody>
  </table>


</div>


<div id="smallmenu">
  <table style="border-collapse: collapse; border: none;margin-top: 20px;" cellspacing="0" cellpadding="0" width="100%">
    <tbody>
      <tr>
        <td style="width: 35%; border-right: solid grey 1.0pt; " valign="top" width="35%">
          <p style="text-align: center;font-weight: 700;font-size: 13px;"><span style="color: black;"><a
                href="https://projects.jhkforecasts.com/democratic_primary/"><span style="color: black;">Democratic
                  Primary</span></a><span></p>
        </td>
        <td style="width: 30%; border-right: solid grey 1.0pt; border-left: none; " valign="top" width="30%">
          <p style="text-align: center;font-weight: 700;font-size: 13px;"><span style="color: black;"><a
                href="https://projects.jhkforecasts.com/presidential_forecast/"><span
                  style="color: black;">Presidential</span></a></span></p>
        </td>
        <td style="width: 35%; ; " valign="top" width="35%">
          <p style="text-align: center;font-weight: 700;font-size: 13px;"><span style="color: black;"><a
                href="https://projects.jhkforecasts.com/senate_forecast/"><span
                  style="color: black;">Senate</span></a></span></p>
        </td>
      </tr>
    </tbody>
  </table>
</div>



<h1
  style="text-align: center;font-size: 35;font-weight: 900; border-bottom: solid;border-top: solid;border-right: solid;border-left: solid;background-color: darkblue;color: white;">
  Democratic Primary Manipulator</h1>
  <table style="border-collapse: collapse;" cellspacing="0" cellpadding="0" width="100%">
    <tbody>
  
    </tbody>
  </table>
<div class="sticky">
  <table style="border-collapse: collapse;" cellspacing="0" cellpadding="0" width="100%">
    <tbody>
      <tr >
        <td style="width: 13%;">
          <img style="width:70%;margin-left: 15%;" src="https://jhkforecasts.com/Biden-01.png" alt="Biden">
        </td>
        <td style="width: 13%;">
          <img style="width:70%;margin-left: 15%;" src="https://jhkforecasts.com/Bloomberg-01.png" alt="Bloomberg">
        </td>
        <td style="width: 13%;">
          <img style="width:70%;margin-left: 15%;" src="https://jhkforecasts.com/Buttigieg-01.png" alt="Buttigieg">
        </td>
        <td style="width: 13%;">
          <img style="width:70%;margin-left: 15%;" src="https://jhkforecasts.com/Klobuchar-01.png" alt="Klobuchar">
        </td>
        <td style="width: 13%;">
          <img style="width:70%;margin-left: 15%;" src="https://jhkforecasts.com/Sanders-01.png" alt="Sanders">
        </td>
        <td style="width: 13%;">
          <img style="width:70%;margin-left: 15%;" src="https://jhkforecasts.com/Steyer-01.png" alt="Steyer">
        </td>
        <td style="width: 13%;">
          <img style="width:70%;margin-left: 15%;" src="https://jhkforecasts.com/Warren-01.png" alt="Warren">
        </td>
        <td style="width: 9%;" valign="bottom">
          <h4 style="text-align:center;">Total</h4>

        </td>
      </tr>
      
      <tr>
        <td style="width: 13%;">
          <h3 style="text-align:center;font-weight: 600;" id="biden-text">
            </h1>
        </td>
        <td style="width: 13%;">
          <h3 style="text-align:center;font-weight: 600;" id="bloomberg-text">
            </h1>
        </td>
        <td style="width: 13%;">
          <h3 style="text-align:center;font-weight: 600;" id="buttigieg-text">
            </h1>
        </td>
        <td style="width: 13%;">
          <h3 style="text-align:center;font-weight: 600;" id="klobuchar-text">
            </h1>
        </td>
        <td style="width: 13%;">
          <h3 style="text-align:center;font-weight: 600;" id="sanders-text">
            </h1>
        </td>
        <td style="width: 13%;">
          <h3 style="text-align:center;font-weight: 600;" id="steyer-text">
            </h1>
        </td>
        <td style="width: 13%;">
          <h3 style="text-align:center;font-weight: 600;" id="warren-text">
            </h1>
        </td>
        <td style="width: 9%;">
          <h4 style="text-align:center;" id="total-text"></h4>
        </td>
      </tr>
      <tr style="border-bottom: black solid .5px;">
        <td style="width: 13%;">
          <input type="range" min="0" max="60" value="0" class="slider" id="biden-slider">
        </td>
        <td style="width: 13%;">
          <input type="range" min="0" max="60" value="0" class="slider" id="bloomberg-slider">
        </td>
        <td style="width: 13%;">
          <input type="range" min="0" max="60" value="0" class="slider" id="buttigieg-slider">
        </td>
        <td style="width: 13%;">
          <input type="range" min="0" max="60" value="0" class="slider" id="klobuchar-slider">
        </td>
        <td style="width: 13%;">
          <input type="range" min="0" max="60" value="0" class="slider" id="sanders-slider">
        </td>
        <td style="width: 13%;">
          <input type="range" min="0" max="60" value="0" class="slider" id="steyer-slider">
        </td>
        <td style="width: 13%;">
          <input type="range" min="0" max="60" value="0" class="slider" id="warren-slider">
        </td>
      </tr>
      <tr style="margin-top: -30px;border-bottom: black solid .5px;">
        <td style="width: 13%;">
          <h3 style="text-align:center;font-weight: 600;" id="biden">
            </h1>
        </td>
        <td style="width: 13%;">
          <h3 style="text-align:center;font-weight: 600;" id="bloomberg">
            </h1>
        </td>
        <td style="width: 13%;">
          <h3 style="text-align:center;font-weight: 600;" id="buttigieg">
            </h1>
        </td>
        <td style="width: 13%;">
          <h3 style="text-align:center;font-weight: 600;" id="klobuchar">
            </h1>
        </td>
        <td style="width: 13%;">
          <h3 style="text-align:center;font-weight: 600;" id="sanders">
            </h1>
        </td>
        <td style="width: 13%;">
          <h3 style="text-align:center;font-weight: 600;" id="steyer">
            </h1>
        </td>
        <td style="width: 13%;">
          <h3 style="text-align:center;font-weight: 600;" id="warren">
            </h1>
        </td>
        <td style="width: 9%;border-bottom: white solid .5px;">
          <h4 style="text-align:center;">Adjusted</h4>
          <h4 style="text-align:center;" id="total-text"></h4>
        </td>
      </tr>
      <tr style="margin-top: -30px;border-bottom: black solid .5px;">
        <td style="width: 13%;">
          <h3 style="text-align:center;" id="bidendel">
            </h1>
        </td>
        <td style="width: 13%;">
          <h3 style="text-align:center;" id="bloombergdel">
            </h1>
        </td>
        <td style="width: 13%;">
          <h3 style="text-align:center;" id="buttigiegdel">
            </h1>
        </td>
        <td style="width: 13%;">
          <h3 style="text-align:center;" id="klobuchardel">
            </h1>
        </td>
        <td style="width: 13%;">
          <h3 style="text-align:center;" id="sandersdel">
            </h1>
        </td>
        <td style="width: 13%;">
          <h3 style="text-align:center;" id="steyerdel">
            </h1>
        </td>
        <td style="width: 13%;">
          <h3 style="text-align:center;" id="warrendel">
            </h1>
        </td>
        <td style="width: 9%;border-bottom: white solid .5px;">
          <h4 style="text-align:center;">Delegates</h4>

        </td>
      </tr>
    </tbody>
  </table>
</div>
<h3 style="font-weight: 800;text-align: center;">Slide Bars to adjust vote share</h3>
<div id="bubblemap"></div>
<input id="state-search" style="width:200px;font-size: 20px;text-align: center;margin-top:10" type="text"
  value="Florida">
<div id="statechange"></div>
</select>
<script>
  var margin2 = { top: 0, right: 70, bottom: 0, left: 50 }
  var width2 = 860 - margin2.left - margin2.right
  var height2 = 445
  var axisPad = 12
  var R = 7


  var div = d3.select("#bubblemap").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);

  var x = d3.scaleLinear()
    .domain([0, 780])
    .range([0, width2])

  var y = d3.scaleLinear()
    .domain([0, 445])
    .range([0, height2]);

  var svg = d3.select("#bubblemap").append("svg")
    .attr("viewBox", '0 0 860 445')
    .append('g')
    .attr("transform", "translate(" + margin2.left + "," + margin2.top + ")");
  var SVG = d3.select("#statechange").append("svg")
    .attr("viewBox", '0 0 1000 575')

  var tool_tip = d3.tip()
    .attr("class", "d3-tip")
    .offset([-150, -30])
    .html("<div id='tipDiv'></div>");

  svg.call(tool_tip);
  var w = window.innerWidth
  var margin = (w - 200) / 2
  document.getElementById("state-search").style.marginLeft = margin

  var parseTime = d3.timeParse("%Y-%m-%d")
  var formatTime = d3.timeFormat("%m/%d/%y")
  var numberformat = d3.format(".1f")
  var candidates = ["Biden", "Bloomberg", "Buttigieg", "Klobuchar", "Sanders", "Steyer", "Warren"]

  var color = d3.scaleOrdinal()
    .domain(candidates)
    .range(["#00C181", "#FF6060", "#FFE130", "#FF8D32", "#0091FF", "#FF2EF0", "#AF0BFF"])

  var focus = svg.append("g")
    .attr("class", "focus")
    .style("display", "none");



  var overlay = svg.append("rect")
    .attr("class", "overlay")
    .attr("x", 0)
    .attr("width", 860)
    .attr("height", 445)

  d3.csv("manip.csv", (data) => {

    var us = data[57]

    

    var data = data.filter(function (d) { return d.State != "US"; })
    var statesnames = data.map((d)=>{
      return d.State
    })
    console.log(statesnames)
    document.getElementById("biden-slider").value = us[candidates[0]] 
    document.getElementById("bloomberg-slider").value = us[candidates[1]]
    document.getElementById("buttigieg-slider").value = us[candidates[2]]
    document.getElementById("klobuchar-slider").value = us[candidates[3]]
    document.getElementById("sanders-slider").value = us[candidates[4]]
    document.getElementById("steyer-slider").value = us[candidates[5]]
    document.getElementById("warren-slider").value = us[candidates[6]]
    document.getElementById("state-search").value = statesnames[Math.round(Math.random()*56)]
    update(d3.select('#biden-slider').property('value'), d3.select('#bloomberg-slider').property('value'), d3.select('#buttigieg-slider').property('value'), d3.select('#klobuchar-slider').property('value'), d3.select('#sanders-slider').property('value'), d3.select('#steyer-slider').property('value'), d3.select('#warren-slider').property('value'))

    function update(biden, bloomberg, buttigieg, klobuchar, sanders, steyer, warren) {
      var cands = [biden, bloomberg, buttigieg, klobuchar, sanders, steyer, warren]
      var change = {
        [candidates[0]]: biden / us[candidates[0]],
        [candidates[1]]: bloomberg / us[candidates[1]],
        [candidates[2]]: buttigieg / us[candidates[2]],
        [candidates[3]]: klobuchar / us[candidates[3]],
        [candidates[4]]: sanders / us[candidates[4]],
        [candidates[5]]: steyer / us[candidates[5]],
        [candidates[6]]: warren / us[candidates[6]],
        [candidates[0] + "change"]: biden - us[candidates[0]],
        [candidates[1] + "change"]: bloomberg - us[candidates[1]],
        [candidates[2] + "change"]: buttigieg - us[candidates[2]],
        [candidates[3] + "change"]: klobuchar - us[candidates[3]],
        [candidates[4] + "change"]: sanders - us[candidates[4]],
        [candidates[5] + "change"]: steyer - us[candidates[5]],
        [candidates[6] + "change"]: warren - us[candidates[6]],
      }
      document.getElementById("biden-text").innerHTML = cands[0]+"%"
      document.getElementById("bloomberg-text").innerHTML = cands[1]+"%"
      document.getElementById("buttigieg-text").innerHTML = cands[2]+"%"
      document.getElementById("klobuchar-text").innerHTML = cands[3]+"%"
      document.getElementById("sanders-text").innerHTML = cands[4]+"%"
      document.getElementById("steyer-text").innerHTML = cands[5]+"%"
      document.getElementById("warren-text").innerHTML = cands[6]+"%"
      document.getElementById("total-text").innerHTML = d3.sum(cands)+"%"
      document.getElementById("biden").innerHTML = numberformat((100 / d3.sum(cands)) * cands[0])+"%"
      document.getElementById("bloomberg").innerHTML = numberformat((100 / d3.sum(cands)) * cands[1])+"%"
      document.getElementById("buttigieg").innerHTML = numberformat((100 / d3.sum(cands)) * cands[2])+"%"
      document.getElementById("klobuchar").innerHTML = numberformat((100 / d3.sum(cands)) * cands[3])+"%"
      document.getElementById("sanders").innerHTML = numberformat((100 / d3.sum(cands)) * cands[4])+"%"
      document.getElementById("steyer").innerHTML = numberformat((100 / d3.sum(cands)) * cands[5])+"%"
      document.getElementById("warren").innerHTML = numberformat((100 / d3.sum(cands)) * cands[6])+"%"

      var newdata = data.map((d, i) => {
        return {
          State: d.State,
          Delegates: +d.Delegates,
          Date: parseTime(d.Date),
          [candidates[0]]: d[candidates[0] + "res"] != "" ? +d[candidates[0] + "res"] : +d[candidates[0]] == 0 ? 0 : ((+d[candidates[0]] * change[candidates[0]]) + (+d[candidates[0]] + change[candidates[0] + "change"])) / 2 > 90 ? 90 : ((+d[candidates[0]] * change[candidates[0]]) + (+d[candidates[0]] + change[candidates[0] + "change"])) / 2 < 0 ? 0 : ((+d[candidates[0]] * change[candidates[0]]) + (+d[candidates[0]] + change[candidates[0] + "change"])) / 2,
          [candidates[1]]: d[candidates[1] + "res"] != "" ? +d[candidates[1] + "res"] : +d[candidates[1]] == 0 ? 0 : ((+d[candidates[1]] * change[candidates[1]]) + (+d[candidates[1]] + change[candidates[1] + "change"])) / 2 > 90 ? 90 : ((+d[candidates[1]] * change[candidates[1]]) + (+d[candidates[1]] + change[candidates[1] + "change"])) / 2 < 0 ? 0 : ((+d[candidates[1]] * change[candidates[1]]) + (+d[candidates[1]] + change[candidates[1] + "change"])) / 2,
          [candidates[2]]: d[candidates[2] + "res"] != "" ? +d[candidates[2] + "res"] : +d[candidates[2]] == 0 ? 0 : ((+d[candidates[2]] * change[candidates[2]]) + (+d[candidates[2]] + change[candidates[2] + "change"])) / 2 > 90 ? 90 : ((+d[candidates[2]] * change[candidates[2]]) + (+d[candidates[2]] + change[candidates[2] + "change"])) / 2 < 0 ? 0 : ((+d[candidates[2]] * change[candidates[2]]) + (+d[candidates[2]] + change[candidates[2] + "change"])) / 2,
          [candidates[3]]: d[candidates[3] + "res"] != "" ? +d[candidates[3] + "res"] : +d[candidates[3]] == 0 ? 0 : ((+d[candidates[3]] * change[candidates[3]]) + (+d[candidates[3]] + change[candidates[3] + "change"])) / 2 > 90 ? 90 : ((+d[candidates[3]] * change[candidates[3]]) + (+d[candidates[3]] + change[candidates[3] + "change"])) / 2 < 0 ? 0 : ((+d[candidates[3]] * change[candidates[3]]) + (+d[candidates[3]] + change[candidates[3] + "change"])) / 2,
          [candidates[4]]: d[candidates[4] + "res"] != "" ? +d[candidates[4] + "res"] : +d[candidates[4]] == 0 ? 0 : ((+d[candidates[4]] * change[candidates[4]]) + (+d[candidates[4]] + change[candidates[4] + "change"])) / 2 > 90 ? 90 : ((+d[candidates[4]] * change[candidates[4]]) + (+d[candidates[4]] + change[candidates[4] + "change"])) / 2 < 0 ? 0 : ((+d[candidates[4]] * change[candidates[4]]) + (+d[candidates[4]] + change[candidates[4] + "change"])) / 2,
          [candidates[5]]: d[candidates[5] + "res"] != "" ? +d[candidates[5] + "res"] : +d[candidates[5]] == 0 ? 0 : ((+d[candidates[5]] * change[candidates[5]]) + (+d[candidates[5]] + change[candidates[5] + "change"])) / 2 > 90 ? 90 : ((+d[candidates[5]] * change[candidates[5]]) + (+d[candidates[5]] + change[candidates[5] + "change"])) / 2 < 0 ? 0 : ((+d[candidates[5]] * change[candidates[5]]) + (+d[candidates[5]] + change[candidates[5] + "change"])) / 2,
          [candidates[6]]: d[candidates[6] + "res"] != "" ? +d[candidates[6] + "res"] : +d[candidates[6]] == 0 ? 0 : ((+d[candidates[6]] * change[candidates[6]]) + (+d[candidates[6]] + change[candidates[6] + "change"])) / 2 > 90 ? 90 : ((+d[candidates[6]] * change[candidates[6]]) + (+d[candidates[6]] + change[candidates[6] + "change"])) / 2 < 0 ? 0 : ((+d[candidates[6]] * change[candidates[6]]) + (+d[candidates[6]] + change[candidates[6] + "change"])) / 2,
        }
      })

      newdata.forEach(function (d, i) {
        d.total = d[candidates[0]] + d[candidates[1]] + d[candidates[2]] + d[candidates[3]] + d[candidates[4]] + d[candidates[5]] + d[candidates[6]]
        d[candidates[0]] = data[i][candidates[0] + "res"] != "" ? +data[i][candidates[0] + "res"] : 100 / d.total * +d[candidates[0]]
        d[candidates[1]] = data[i][candidates[1] + "res"] != "" ? +data[i][candidates[1] + "res"] : 100 / d.total * +d[candidates[1]]
        d[candidates[2]] = data[i][candidates[2] + "res"] != "" ? +data[i][candidates[2] + "res"] : 100 / d.total * +d[candidates[2]]
        d[candidates[3]] = data[i][candidates[3] + "res"] != "" ? +data[i][candidates[3] + "res"] : 100 / d.total * +d[candidates[3]]
        d[candidates[4]] = data[i][candidates[4] + "res"] != "" ? +data[i][candidates[4] + "res"] : 100 / d.total * +d[candidates[4]]
        d[candidates[5]] = data[i][candidates[5] + "res"] != "" ? +data[i][candidates[5] + "res"] : 100 / d.total * +d[candidates[5]]
        d[candidates[6]] = data[i][candidates[6] + "res"] != "" ? +data[i][candidates[6] + "res"] : 100 / d.total * +d[candidates[6]]
        d[candidates[0] + "under15"] = data[i][candidates[0] + "res"] != "" ? 0 : d[candidates[0]] < 15 ? d[candidates[0]] > 10 ? Math.round((.02 * d[candidates[0]] - .2) * +data[i].Delegates) : 0 : 0
        d[candidates[1] + "under15"] = data[i][candidates[1] + "res"] != "" ? 0 : d[candidates[1]] < 15 ? d[candidates[1]] > 10 ? Math.round((.02 * d[candidates[1]] - .2) * +data[i].Delegates) : 0 : 0
        d[candidates[2] + "under15"] = data[i][candidates[2] + "res"] != "" ? 0 : d[candidates[2]] < 15 ? d[candidates[2]] > 10 ? Math.round((.02 * d[candidates[2]] - .2) * +data[i].Delegates) : 0 : 0
        d[candidates[3] + "under15"] = data[i][candidates[3] + "res"] != "" ? 0 : d[candidates[3]] < 15 ? d[candidates[3]] > 10 ? Math.round((.02 * d[candidates[3]] - .2) * +data[i].Delegates) : 0 : 0
        d[candidates[4] + "under15"] = data[i][candidates[4] + "res"] != "" ? 0 : d[candidates[4]] < 15 ? d[candidates[4]] > 10 ? Math.round((.02 * d[candidates[4]] - .2) * +data[i].Delegates) : 0 : 0
        d[candidates[5] + "under15"] = data[i][candidates[5] + "res"] != "" ? 0 : d[candidates[5]] < 15 ? d[candidates[5]] > 10 ? Math.round((.02 * d[candidates[5]] - .2) * +data[i].Delegates) : 0 : 0
        d[candidates[6] + "under15"] = data[i][candidates[6] + "res"] != "" ? 0 : d[candidates[6]] < 15 ? d[candidates[6]] > 10 ? Math.round((.02 * d[candidates[6]] - .2) * +data[i].Delegates) : 0 : 0
        d.sumover15 = (d[candidates[0]] > 15 ? d[candidates[0]] : 0) + (d[candidates[1]] > 15 ? d[candidates[1]] : 0) + (d[candidates[2]] > 15 ? d[candidates[2]] : 0) + (d[candidates[3]] > 15 ? d[candidates[3]] : 0) + (d[candidates[4]] > 15 ? d[candidates[4]] : 0) + (d[candidates[5]] > 15 ? d[candidates[5]] : 0) + (d[candidates[6]] > 15 ? d[candidates[6]] : 0)
        d[candidates[0] + "over15"] = data[i][candidates[0] + "res"] != "" ? +data[i][candidates[0] + "resdel"] : d[candidates[0]] > 15 ? Math.round((d[candidates[0]] / d.sumover15) * +data[i].Delegates) : 0
        d[candidates[1] + "over15"] = data[i][candidates[1] + "res"] != "" ? +data[i][candidates[1] + "resdel"] : d[candidates[1]] > 15 ? Math.round((d[candidates[1]] / d.sumover15) * +data[i].Delegates) : 0
        d[candidates[2] + "over15"] = data[i][candidates[2] + "res"] != "" ? +data[i][candidates[2] + "resdel"] : d[candidates[2]] > 15 ? Math.round((d[candidates[2]] / d.sumover15) * +data[i].Delegates) : 0
        d[candidates[3] + "over15"] = data[i][candidates[3] + "res"] != "" ? +data[i][candidates[3] + "resdel"] : d[candidates[3]] > 15 ? Math.round((d[candidates[3]] / d.sumover15) * +data[i].Delegates) : 0
        d[candidates[4] + "over15"] = data[i][candidates[4] + "res"] != "" ? +data[i][candidates[4] + "resdel"] : d[candidates[4]] > 15 ? Math.round((d[candidates[4]] / d.sumover15) * +data[i].Delegates) : 0
        d[candidates[5] + "over15"] = data[i][candidates[5] + "res"] != "" ? +data[i][candidates[5] + "resdel"] : d[candidates[5]] > 15 ? Math.round((d[candidates[5]] / d.sumover15) * +data[i].Delegates) : 0
        d[candidates[6] + "over15"] = data[i][candidates[6] + "res"] != "" ? +data[i][candidates[6] + "resdel"] : d[candidates[6]] > 15 ? Math.round((d[candidates[6]] / d.sumover15) * +data[i].Delegates) : 0
        d[candidates[0] + "delegates"] = d[candidates[0] + "over15"] + d[candidates[0] + "under15"]
        d[candidates[1] + "delegates"] = d[candidates[1] + "over15"] + d[candidates[1] + "under15"]
        d[candidates[2] + "delegates"] = d[candidates[2] + "over15"] + d[candidates[2] + "under15"]
        d[candidates[3] + "delegates"] = d[candidates[3] + "over15"] + d[candidates[3] + "under15"]
        d[candidates[4] + "delegates"] = d[candidates[4] + "over15"] + d[candidates[4] + "under15"]
        d[candidates[5] + "delegates"] = d[candidates[5] + "over15"] + d[candidates[5] + "under15"]
        d[candidates[6] + "delegates"] = d[candidates[6] + "over15"] + d[candidates[6] + "under15"]
        return d;
      })

      console.log(newdata)

      var finaldata = []
      for (let j = 0; j < 57; j++) {
        var keystate = newdata[j].State

        var dataraw = newdata.filter(function (d) { return d.State == keystate; })

        for (let k = 0; k < 7; k++) {
          var final = dataraw.map((d) => {
            return {
              state: dataraw[0].State,
              candidate: candidates[k],
              vote: d[candidates[k]],
              delegates: d[candidates[k] + "delegates"]
            }
          })
          finaldata.push(final[0])
        }
      }
      var bidendel = d3.sum(finaldata.filter(d => d.candidate == "Biden"), d => d.delegates)
      document.getElementById("bidendel").innerHTML = bidendel
      document.getElementById("bidendel").style.fontWeight = bidendel > 1989 ? 900 : 600

      var bloombergdel = d3.sum(finaldata.filter(d => d.candidate == "Bloomberg"), d => d.delegates)
      document.getElementById("bloombergdel").innerHTML = bloombergdel
      document.getElementById("bloombergdel").style.fontWeight = bloombergdel > 1989 ? 900 : 600

      var buttigiegdel = d3.sum(finaldata.filter(d => d.candidate == "Buttigieg"), d => d.delegates)
      document.getElementById("buttigiegdel").innerHTML = buttigiegdel
      document.getElementById("buttigiegdel").style.fontWeight = buttigiegdel > 1989 ? 900 : 600


      var klobuchardel = d3.sum(finaldata.filter(d => d.candidate == "Klobuchar"), d => d.delegates)
      document.getElementById("klobuchardel").innerHTML = klobuchardel
      document.getElementById("klobuchardel").style.fontWeight = klobuchardel > 1989 ? 900 : 600

      var sandersdel = d3.sum(finaldata.filter(d => d.candidate == "Sanders"), d => d.delegates)
      document.getElementById("sandersdel").innerHTML = sandersdel
      document.getElementById("sandersdel").style.fontWeight = sandersdel > 1989 ? 900 : 600

      var steyerdel = d3.sum(finaldata.filter(d => d.candidate == "Steyer"), d => d.delegates)
      document.getElementById("steyerdel").innerHTML = steyerdel
      document.getElementById("steyerdel").style.fontWeight = steyerdel > 1989 ? 900 : 600

      var warrendel = d3.sum(finaldata.filter(d => d.candidate == "Warren"), d => d.delegates)
      document.getElementById("warrendel").innerHTML = warrendel
      document.getElementById("warrendel").style.fontWeight = warrendel > 1989 ? 900 : 600


      var mapdata = []
      for (let j = 0; j < 57; j++) {
        var keystate = newdata[j].State

        var dataraw = finaldata.filter(function (d) { return d.state == keystate; })
        var dataraw = dataraw
        dataraw.sort((a, b) => b.vote - a.vote)

        var rank = {
          state: newdata[j].State,
          xValue: +data[j].xValue,
          yValue: +data[j].yValue,
          radius: +data[j].radius,
          abbrev: data[j].abbrev,
          first: dataraw[0].candidate,
          firstvote: +numberformat(dataraw[0].vote),
          second: dataraw[1].candidate,
          secondvote: +numberformat(dataraw[1].vote),
          third: dataraw[2].candidate,
          thirdvote: +numberformat(dataraw[2].vote),
          fourth: dataraw[3].candidate,
          fourthvote: +numberformat(dataraw[3].vote),
        }

        mapdata.push(rank)
      }
      console.log(finaldata)
      console.log(mapdata)


      var states = svg.selectAll(".states")
        .data(mapdata);

      states.exit().remove();

      states.enter()
        .append("circle")
        .attr("cx", d => x(d.xValue))
        .attr("cy", d => y(d.yValue))
        .attr("r", d => d.radius)
        .attr("stroke", "white")
        .style("fill", d => color(d.first))
        .on('mouseover', function (d) {
          tool_tip.show();
          var tipSVG = d3.select("#tipDiv")
            .append("svg")
            .attr("width", 200)
            .attr("height", 140);

          tipSVG.append("rect")
            .attr("x", 0)
            .attr("y", 0)
            .attr("width", 200)
            .attr("height", 140)
            .attr("fill", "white")
            .attr("stroke", "black")
            .attr("stroke-width", 3)
            .attr("rx", 10)



          tipSVG.append("text")
            .text(d.state)
            .attr("y", 20)
            .attr("x", 87.5)
            .attr("fill", "black")
            .style("font-weight", "600")
            .style("font-size", "20")
            .attr("text-anchor", "middle");

          tipSVG.append("text")
            .text("Candidate")
            .attr("y", 50)
            .attr("x", 5)
            .attr("fill", "black")
            .style("font-weight", "600")
            .style("font-size", "15");
          tipSVG.append("text")
            .text("Vote Share")
            .attr("y", 50)
            .attr("x", 150)
            .attr("fill", "black")
            .style("font-weight", "600")
            .style("font-size", "15")
            .attr("text-anchor", "middle")
            ;


          tipSVG.append("text")
            .text(d.first)
            .attr("y", 70)
            .attr("x", 5)
            .attr("fill", color(d.first))
            .style("font-weight", "600")
            .style("font-size", "15");


          tipSVG.append("text")
            .text(d.firstvote + "%")
            .attr("y", 70)
            .attr("x", 150)
            .attr("fill", color(d.first))
            .style("font-weight", "600")
            .style("font-size", "15")
            .attr("text-anchor", "middle")
            ;

          tipSVG.append("text")
            .text(d.second)
            .attr("y", 90)
            .attr("x", 5)
            .attr("fill", color(d.second))
            .style("font-weight", "600")
            .style("font-size", "15");

          tipSVG.append("text")
            .text(d.secondvote + "%")
            .attr("y", 90)
            .attr("x", 150)
            .attr("fill", color(d.second))
            .style("font-weight", "600")
            .style("font-size", "15")
            .attr("text-anchor", "middle")
            ;

          tipSVG.append("text")
            .text(d.third)
            .attr("y", 110)
            .attr("x", 5)
            .attr("fill", color(d.third))
            .style("font-weight", "600")
            .style("font-size", "15");

          tipSVG.append("text")
            .text(d.thirdvote + "%")
            .attr("y", 110)
            .attr("x", 150)
            .attr("fill", color(d.third))
            .style("font-weight", "600")
            .style("font-size", "15")
            .attr("text-anchor", "middle")
            ;

          tipSVG.append("text")
            .text(d.fourth)
            .attr("y", 130)
            .attr("x", 5)
            .attr("fill", color(d.fourth))
            .style("font-weight", "600")
            .style("font-size", "15")


          tipSVG.append("text")
            .text(d.fourthvote + "%")
            .attr("y", 130)
            .attr("x", 150)
            .attr("fill", color(d.fourth))
            .style("font-weight", "600")
            .style("font-size", "15")
            .attr("text-anchor", "middle")
            ;



        })
        .on('mouseout', tool_tip.hide)
        .merge(states)
        .transition()
        .duration(1000)
        .attr("fill", "white")


      svg.selectAll("label")
        .data(mapdata)
        .enter()
        .append("text")
        .text(d => d.abbrev)
        .attr("x", d => x(d.xValue))
        .attr("y", d => y(d.yValue) + 3)
        .attr("text-anchor", "middle")
        .attr("font-family", "brandon-grotesque")
        .attr("font-weight", 700)
        .attr("font-size", "8")
        .attr("fill", "black")






      state(d3.select("#state-search").property("value"));
      function state(input) {
        var statedata = finaldata.filter(d => d.state == input)
        console.log(statedata)
        statedata.sort((a, b) => b.vote - a.vote)
        SVG.selectAll(".cands")
          .data(statedata).enter()
          .append("rect")
          .attr("fill", "white")
          .attr("width", 200)
          .attr("height", 100)
          .attr("x", 90)
          .attr("y", (d, i) => i * 35 + 50)

        SVG.selectAll(".cands")
          .data(statedata).enter()
          .append("text")
          .text(d => d.candidate)
          .attr("x", 100)
          .attr("text-anchor", "start")
          .attr("y", (d, i) => i * 35 + 75)
          .attr("dominant-baseline", "middle")
          .attr("background-color", "white")
          .attr("font-size",20)
          .attr("font-weight",700)
          .attr("fill",d=>color(d.candidate))
        SVG.selectAll(".cands")
          .data(statedata).enter()
          .append("rect")
          .attr("fill", "white")
          .attr("width", 300)
          .attr("height", 75)
          .attr("x", 400)
          .attr("y", (d, i) => i * 35 + 50)
        SVG.selectAll(".cands")
          .data(statedata).enter()
          .append("text")
          .text(d => numberformat(d.vote) + "%")
          .attr("x", 600)
          .attr("text-anchor", "middle")
          .attr("y", (d, i) => i * 35 + 75)
          .attr("dominant-baseline", "middle")
          .attr("background-color", "white")
          .attr("font-size",20)
          .attr("font-weight",700)

        SVG.selectAll(".cands")
          .data(statedata).enter()
          .append("rect")
          .attr("fill", "white")
          .attr("width", 300)
          .attr("height", 75)
          .attr("x", 700)
          .attr("y", (d, i) => i * 35 + 50)
        SVG.selectAll(".cands")
          .data(statedata).enter()
          .append("text")
          .text(d => d.delegates)
          .attr("x", 800)
          .attr("text-anchor", "middle")
          .attr("y", (d, i) => i * 35 + 75)
          .attr("dominant-baseline", "middle")
          .attr("background-color", "white")
          .attr("font-size",20)
          .attr("font-weight",700)
          

          SVG.append("text")
          .text("Candidate")
          .attr("x", 100)
          .attr("text-anchor", "start")
          .attr("y", 40)
          .attr("dominant-baseline", "middle")
          .attr("background-color", "white")
          .attr("font-size",20)
          .attr("font-weight",700)

          SVG.append("text")
          .text("Vote")
          .attr("x", 600)
          .attr("text-anchor", "middle")
          .attr("y", 40)
          .attr("dominant-baseline", "middle")
          .attr("background-color", "white")
          .attr("font-size",20)
          .attr("font-weight",700)
          SVG.append("text")
          .text("Delegates")
          .attr("x", 800)
          .attr("text-anchor", "middle")
          .attr("y", 40)
          .attr("dominant-baseline", "middle")
          .attr("background-color", "white")
          .attr("font-size",20)
          .attr("font-weight",700)





      }

      var states = d3.select("#state-search")
        .on("change", function () {
          state(this.value);

        })

      var bi = d3.select("#biden-slider")
        .on("change", function () {
          update(+this.value, bloomberg, buttigieg, klobuchar, sanders, steyer, warren);
        })

      var bl = d3.select("#bloomberg-slider")
        .on("change", function () {
          update(biden, +this.value, buttigieg, klobuchar, sanders, steyer, warren);
        })
      var bu = d3.select("#buttigieg-slider")
        .on("change", function () {
          update(biden, bloomberg, +this.value, klobuchar, sanders, steyer, warren);
        })
      var kl = d3.select("#klobuchar-slider")
        .on("change", function () {
          update(biden, bloomberg, buttigieg, +this.value, sanders, steyer, warren);
        })
      var sa = d3.select("#sanders-slider")
        .on("change", function () {
          update(biden, bloomberg, buttigieg, klobuchar, +this.value, steyer, warren);
        })
      var st = d3.select("#steyer-slider")
        .on("change", function () {
          update(biden, bloomberg, buttigieg, klobuchar, sanders, +this.value, warren);
        })
      var wa = d3.select("#warren-slider")
        .on("change", function () {
          update(biden, bloomberg, buttigieg, klobuchar, sanders, steyer, +this.value);
        })
    }

  })




</script>
</body>
</script>




</body>

</html